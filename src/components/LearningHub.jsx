import{j as t,u as fs,a as ps,s as Xt,L as xs}from"./index-CnskRoEk.js";import{r as h,u as ys,h as bs,R as Y}from"./react-vendor-u6da99lV.js";import{l as ws}from"./stripe-vendor-Cebp-8gm.js";import{L as vs}from"./ui-vendor-Dt3Fi5LI.js";import{l as js,g as ks,a as Cs,b as kn,c as Cn,d as Nn,e as Sn,f as Ns,h as Ss,s as Ts,i as Es,j as Ls,m as Ms,k as Rs,n as Is,o as _s,u as As}from"./api-BkxvA_y_.js";import{X as Tt,T as Fs,a as $s,P as Ps,V as Tn,F as Bs,C as Os,b as Ds,c as Ws,d as Us,S as Hs}from"./icons-Blm5tfcR.js";import"./supabase-vendor-DSKd7n9a.js";import KnowledgeCheck from"./KnowledgeCheck";var Zt={};(function Z($,ge,A,fe){var Ce=!!($.Worker&&$.Blob&&$.Promise&&$.OffscreenCanvas&&$.OffscreenCanvasRenderingContext2D&&$.HTMLCanvasElement&&$.HTMLCanvasElement.prototype.transferControlToOffscreen&&$.URL&&$.URL.createObjectURL),q=typeof Path2D=="function"&&typeof DOMMatrix=="function",re=(function(){if(!$.OffscreenCanvas)return!1;try{var a=new OffscreenCanvas(1,1),o=a.getContext("2d");o.fillRect(0,0,1,1);var y=a.transferToImageBitmap();o.createPattern(y,"no-repeat")}catch{return!1}return!0})();function te(){}function pe(a){var o=ge.exports.Promise,y=o!==void 0?o:$.Promise;return typeof y=="function"?new y(a):(a(te,te),null)}var V=(function(a,o){return{transform:function(y){if(a)return y;if(o.has(y))return o.get(y);var k=new OffscreenCanvas(y.width,y.height),S=k.getContext("2d");return S.drawImage(y,0,0),o.set(y,k),k},clear:function(){o.clear()}}})(re,new Map),de=(function(){var a=Math.floor(16.666666666666668),o,y,k={},S=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(o=function(T){var E=Math.random();return k[E]=requestAnimationFrame(function v(L){S===L||S+a-1<L?(S=L,delete k[E],T()):k[E]=requestAnimationFrame(v)}),E},y=function(T){k[T]&&cancelAnimationFrame(k[T])}):(o=function(T){return setTimeout(T,a)},y=function(T){return clearTimeout(T)}),{frame:o,cancel:y}})(),le=(function(){var a,o,y={};function k(S){function T(E,v){S.postMessage({options:E||{},callback:v})}S.init=function(v){var L=v.transferControlToOffscreen();S.postMessage({canvas:L},[L])},S.fire=function(v,L,x){if(o)return T(v,null),o;var w=Math.random().toString(36).slice(2);return o=pe(function(p){function b(F){F.data.callback===w&&(delete y[w],S.removeEventListener("message",b),o=null,V.clear(),x(),p())}S.addEventListener("message",b),T(v,w),y[w]=b.bind(null,{data:{callback:w}})}),o},S.reset=function(){S.postMessage({reset:!0});for(var v in y)y[v](),delete y[v]}}return function(){if(a)return a;if(!A&&Ce){var S=["var CONFETTI, SIZE = {}, module = {};","("+Z.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{a=new Worker(URL.createObjectURL(new Blob([S])))}catch(T){return typeof console<"u"&&typeof console.warn=="function"&&console.warn("üéä Could not load worker",T),null}k(a)}return a}})(),De={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function G(a,o){return o?o(a):a}function ae(a){return a!=null}function H(a,o,y){return G(a&&ae(a[o])?a[o]:De[o],y)}function nt(a){return a<0?0:Math.floor(a)}function M(a,o){return Math.floor(Math.random()*(o-a))+a}function Fe(a){return parseInt(a,16)}function B(a){return a.map(Ge)}function Ge(a){var o=String(a).replace(/[^0-9a-f]/gi,"");return o.length<6&&(o=o[0]+o[0]+o[1]+o[1]+o[2]+o[2]),{r:Fe(o.substring(0,2)),g:Fe(o.substring(2,4)),b:Fe(o.substring(4,6))}}function ue(a){var o=H(a,"origin",Object);return o.x=H(o,"x",Number),o.y=H(o,"y",Number),o}function we(a){a.width=document.documentElement.clientWidth,a.height=document.documentElement.clientHeight}function Te(a){var o=a.getBoundingClientRect();a.width=o.width,a.height=o.height}function Ie(a){var o=document.createElement("canvas");return o.style.position="fixed",o.style.top="0px",o.style.left="0px",o.style.pointerEvents="none",o.style.zIndex=a,o}function ct(a,o,y,k,S,T,E,v,L){a.save(),a.translate(o,y),a.rotate(T),a.scale(k,S),a.arc(0,0,1,E,v,L),a.restore()}function Ke(a){var o=a.angle*(Math.PI/180),y=a.spread*(Math.PI/180);return{x:a.x,y:a.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:a.startVelocity*.5+Math.random()*a.startVelocity,angle2D:-o+(.5*y-Math.random()*y),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:a.color,shape:a.shape,tick:0,totalTicks:a.ticks,decay:a.decay,drift:a.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:a.gravity*3,ovalScalar:.6,scalar:a.scalar,flat:a.flat}}function dt(a,o){o.x+=Math.cos(o.angle2D)*o.velocity+o.drift,o.y+=Math.sin(o.angle2D)*o.velocity+o.gravity,o.velocity*=o.decay,o.flat?(o.wobble=0,o.wobbleX=o.x+10*o.scalar,o.wobbleY=o.y+10*o.scalar,o.tiltSin=0,o.tiltCos=0,o.random=1):(o.wobble+=o.wobbleSpeed,o.wobbleX=o.x+10*o.scalar*Math.cos(o.wobble),o.wobbleY=o.y+10*o.scalar*Math.sin(o.wobble),o.tiltAngle+=.1,o.tiltSin=Math.sin(o.tiltAngle),o.tiltCos=Math.cos(o.tiltAngle),o.random=Math.random()+2);var y=o.tick++/o.totalTicks,k=o.x+o.random*o.tiltCos,S=o.y+o.random*o.tiltSin,T=o.wobbleX+o.random*o.tiltCos,E=o.wobbleY+o.random*o.tiltSin;if(a.fillStyle="rgba("+o.color.r+", "+o.color.g+", "+o.color.b+", "+(1-y)+")",a.beginPath(),q&&o.shape.type==="path"&&typeof o.shape.path=="string"&&Array.isArray(o.shape.matrix))a.fill(Ye(o.shape.path,o.shape.matrix,o.x,o.y,Math.abs(T-k)*.1,Math.abs(E-S)*.1,Math.PI/10*o.wobble));else if(o.shape.type==="bitmap"){var v=Math.PI/10*o.wobble,L=Math.abs(T-k)*.1,x=Math.abs(E-S)*.1,w=o.shape.bitmap.width*o.scalar,p=o.shape.bitmap.height*o.scalar,b=new DOMMatrix([Math.cos(v)*L,Math.sin(v)*L,-Math.sin(v)*x,Math.cos(v)*x,o.x,o.y]);b.multiplySelf(new DOMMatrix(o.shape.matrix));var F=a.createPattern(V.transform(o.shape.bitmap),"no-repeat");F.setTransform(b),a.globalAlpha=1-y,a.fillStyle=F,a.fillRect(o.x-w/2,o.y-p/2,w,p),a.globalAlpha=1}else if(o.shape==="circle")a.ellipse?a.ellipse(o.x,o.y,Math.abs(T-k)*o.ovalScalar,Math.abs(E-S)*o.ovalScalar,Math.PI/10*o.wobble,0,2*Math.PI):ct(a,o.x,o.y,Math.abs(T-k)*o.ovalScalar,Math.abs(E-S)*o.ovalScalar,Math.PI/10*o.wobble,0,2*Math.PI);else if(o.shape==="star")for(var j=Math.PI/2*3,D=4*o.scalar,ne=8*o.scalar,je=o.x,Ee=o.y,$e=5,me=Math.PI/$e;$e--;)je=o.x+Math.cos(j)*ne,Ee=o.y+Math.sin(j)*ne,a.lineTo(je,Ee),j+=me,je=o.x+Math.cos(j)*D,Ee=o.y+Math.sin(j)*D,a.lineTo(je,Ee),j+=me;else a.moveTo(Math.floor(o.x),Math.floor(o.y)),a.lineTo(Math.floor(o.wobbleX),Math.floor(S)),a.lineTo(Math.floor(T),Math.floor(E)),a.lineTo(Math.floor(k),Math.floor(o.wobbleY));return a.closePath(),a.fill(),o.tick<o.totalTicks}function _e(a,o,y,k,S){var T=o.slice(),E=a.getContext("2d"),v,L,x=pe(function(w){function p(){v=L=null,E.clearRect(0,0,k.width,k.height),V.clear(),S(),w()}function b(){A&&!(k.width===fe.width&&k.height===fe.height)&&(k.width=a.width=fe.width,k.height=a.height=fe.height),!k.width&&!k.height&&(y(a),k.width=a.width,k.height=a.height),E.clearRect(0,0,k.width,k.height),T=T.filter(function(F){return dt(E,F)}),T.length?v=de.frame(b):p()}v=de.frame(b),L=p});return{addFettis:function(w){return T=T.concat(w),x},canvas:a,promise:x,reset:function(){v&&de.cancel(v),L&&L()}}}function ye(a,o){var y=!a,k=!!H(o||{},"resize"),S=!1,T=H(o,"disableForReducedMotion",Boolean),E=Ce&&!!H(o||{},"useWorker"),v=E?le():null,L=y?we:Te,x=a&&v?!!a.__confetti_initialized:!1,w=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,p;function b(j,D,ne){for(var je=H(j,"particleCount",nt),Ee=H(j,"angle",Number),$e=H(j,"spread",Number),me=H(j,"startVelocity",Number),ot=H(j,"decay",Number),en=H(j,"gravity",Number),Dt=H(j,"drift",Number),rt=H(j,"colors",B),Wt=H(j,"ticks",Number),at=H(j,"shapes"),Et=H(j,"scalar"),xt=!!H(j,"flat"),yt=ue(j),Ue=je,Je=[],Ae=a.width*yt.x,ut=a.height*yt.y;Ue--;)Je.push(Ke({x:Ae,y:ut,angle:Ee,spread:$e,startVelocity:me,color:rt[Ue%rt.length],shape:at[M(0,at.length)],ticks:Wt,decay:ot,gravity:en,drift:Dt,scalar:Et,flat:xt}));return p?p.addFettis(Je):(p=_e(a,Je,L,D,ne),p.promise)}function F(j){var D=T||H(j,"disableForReducedMotion",Boolean),ne=H(j,"zIndex",Number);if(D&&w)return pe(function(me){me()});y&&p?a=p.canvas:y&&!a&&(a=Ie(ne),document.body.appendChild(a)),k&&!x&&L(a);var je={width:a.width,height:a.height};v&&!x&&v.init(a),x=!0,v&&(a.__confetti_initialized=!0);function Ee(){if(v){var me={getBoundingClientRect:function(){if(!y)return a.getBoundingClientRect()}};L(me),v.postMessage({resize:{width:me.width,height:me.height}});return}je.width=je.height=null}function $e(){p=null,k&&(S=!1,$.removeEventListener("resize",Ee)),y&&a&&(document.body.contains(a)&&document.body.removeChild(a),a=null,x=!1)}return k&&!S&&(S=!0,$.addEventListener("resize",Ee,!1)),v?v.fire(j,je,$e):b(j,je,$e)}return F.reset=function(){v&&v.reset(),p&&p.reset()},F}var ie;function st(){return ie||(ie=ye(null,{useWorker:!0,resize:!0})),ie}function Ye(a,o,y,k,S,T,E){var v=new Path2D(a),L=new Path2D;L.addPath(v,new DOMMatrix(o));var x=new Path2D;return x.addPath(L,new DOMMatrix([Math.cos(E)*S,Math.sin(E)*S,-Math.sin(E)*T,Math.cos(E)*T,y,k])),x}function We(a){if(!q)throw new Error("path confetti are not supported in this browser");var o,y;typeof a=="string"?o=a:(o=a.path,y=a.matrix);var k=new Path2D(o),S=document.createElement("canvas"),T=S.getContext("2d");if(!y){for(var E=1e3,v=E,L=E,x=0,w=0,p,b,F=0;F<E;F+=2)for(var j=0;j<E;j+=2)T.isPointInPath(k,F,j,"nonzero")&&(v=Math.min(v,F),L=Math.min(L,j),x=Math.max(x,F),w=Math.max(w,j));p=x-v,b=w-L;var D=10,ne=Math.min(D/p,D/b);y=[ne,0,0,ne,-Math.round(p/2+v)*ne,-Math.round(b/2+L)*ne]}return{type:"path",path:o,matrix:y}}function ve(a){var o,y=1,k="#000000",S='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof a=="string"?o=a:(o=a.text,y="scalar"in a?a.scalar:y,S="fontFamily"in a?a.fontFamily:S,k="color"in a?a.color:k);var T=10*y,E=""+T+"px "+S,v=new OffscreenCanvas(T,T),L=v.getContext("2d");L.font=E;var x=L.measureText(o),w=Math.ceil(x.actualBoundingBoxRight+x.actualBoundingBoxLeft),p=Math.ceil(x.actualBoundingBoxAscent+x.actualBoundingBoxDescent),b=2,F=x.actualBoundingBoxLeft+b,j=x.actualBoundingBoxAscent+b;w+=b+b,p+=b+b,v=new OffscreenCanvas(w,p),L=v.getContext("2d"),L.font=E,L.fillStyle=k,L.fillText(o,F,j);var D=1/y;return{type:"bitmap",bitmap:v.transferToImageBitmap(),matrix:[D,0,0,D,-w*D/2,-p*D/2]}}ge.exports=function(){return st().apply(this,arguments)},ge.exports.reset=function(){st().reset()},ge.exports.create=ye,ge.exports.shapeFromPath=We,ge.exports.shapeFromText=ve})((function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}})(),Zt,!1);const En=Zt.exports;Zt.exports.create;const zs=({adClient:Z=void 0,adSlot:$=void 0,adFormat:ge="auto",style:A={},isAdFree:fe=!1})=>{const[Ce,q]=h.useState("loading"),re=h.useRef(!1),te=h.useRef(null),pe=h.useRef(null);return h.useEffect(()=>{if(fe){console.log("[GoogleAd] User is ad-free, not loading ads"),q("hidden");return}if(!Z||!$){console.warn("[GoogleAd] Missing ad credentials:",{adClient:Z,adSlot:$}),q("error");return}if(re.current||!te.current||!pe.current)return;const V=te.current.getAttribute("data-ad-status"),de=te.current.getAttribute("data-adsbygoogle-status");if(V==="filled"||de){q("loaded");return}if(typeof window.adsbygoogle>"u"){console.warn("[GoogleAd] AdSense script not loaded. Make sure the script is in index.html head section."),q("error");return}const le=()=>{var ae;const G=((ae=te.current)==null?void 0:ae.offsetWidth)||0;if(G===0){console.log("[GoogleAd] Ins element width is 0, waiting for layout..."),setTimeout(le,100);return}try{console.log("[GoogleAd] Initializing ad with ins width:",G,{adClient:Z,adSlot:$,adFormat:ge}),(window.adsbygoogle=window.adsbygoogle||[]).push({}),re.current=!0,q("loaded"),console.log("[GoogleAd] Ad initialized successfully")}catch(H){console.error("[GoogleAd] Error initializing ad:",H),q("error")}},De=new IntersectionObserver(G=>{G.forEach(ae=>{ae.isIntersecting&&!re.current&&(console.log("[GoogleAd] Ad container is visible, checking width..."),setTimeout(le,200))})},{threshold:.01});return pe.current&&De.observe(pe.current),()=>{De.disconnect(),re.current=!1}},[Z,$,ge,fe]),Ce==="hidden"?null:Ce==="error"?t.jsx("div",{className:"bg-gray-800 rounded-lg flex items-center justify-center",style:{minHeight:"100px",...A},children:t.jsx("p",{className:"text-gray-400 text-xs",children:"Advertisement Unavailable"})}):t.jsx("div",{ref:pe,style:{...A,overflow:"hidden"},children:t.jsx("ins",{ref:te,className:"adsbygoogle",style:{display:"block",height:"60px",maxHeight:"60px",overflow:"hidden"},"data-ad-client":Z,"data-ad-slot":$,"data-ad-format":ge,"data-full-width-responsive":"true"})})}},Gs=ws("pk_live_51SICc4Rxlg2WD2fjAjnITtANLuW4lS0DhUaWgLbe37HgBXHsjyHIO9XCMS8x8no7lWa6ufiAUO92WG5QKjSMJVe800jQFWcp6e"),St=Z=>Z?Z.replace(/\*\*/g,"").replace(/__/g,"").replace(new RegExp("(?<!\\*)\\*(?!\\*)","g"),"").replace(/^[‚Ä¢\-]\s/gm,"").trim():"",Ot=(Z,$,ge,A)=>{if(!Z||!$||!ge||!A)return[];const fe=Z.match(/\S+/g)||[],Ce=[];let q=0;for(let re=0;re<fe.length;re++){const te=fe[re];for(;q<$.length&&/\s/.test($[q]);)q++;if(q>=$.length)break;const pe=ge[q];let V=A[q],de=0;for(let le=0;le<te.length&&q+de<$.length;le++){for(;q+de<$.length&&/\s/.test($[q+de]);)q++;q+de<$.length&&(V=A[q+de],de++)}Ce.push({word:te,start:pe,end:V,index:re}),q+=de}return Ce},so=()=>{const Z=ys(),[$]=bs(),{firstName:ge,user:A,isAdFree:fe,userRole:Ce}=fs(),{lottieData:q}=ps(),re=async()=>{if(!(A!=null&&A.id))return"product-manager";const{data:e}=await Xt.from("users").select("enrolled_course").eq("id",A.id).single();return(e==null?void 0:e.enrolled_course)||"product-manager"},[te,pe]=h.useState(!0),[V,de]=h.useState({}),[le,De]=h.useState([]),[G,ae]=h.useState([]),[H,nt]=h.useState("Product Management"),[M,Fe]=h.useState(parseInt($.get("module"))||1),[B,Ge]=h.useState(parseInt($.get("lesson"))||1),[ue,we]=h.useState([{type:"assistant",text:`Hello, I'm Will.
I'm here to answer any questions you may have on course content. Ask me to dive deeper into a topic or to phrase something differently.`,isComplete:!1}]),[Te,Ie]=h.useState(""),[ct,Ke]=h.useState(!0),[dt,_e]=h.useState(!1),[ye,ie]=h.useState(null),[st,Ye]=h.useState(""),[We,ve]=h.useState(!1),[a,o]=h.useState(0),[y,k]=h.useState(0),[S,T]=h.useState(0),[E,v]=h.useState(!1),[L,x]=h.useState(!1),[w,p]=h.useState(!1),[b,F]=h.useState(null),[j,D]=h.useState(!1),[ne,je]=h.useState(!1),[Ee,$e]=h.useState(!1),[me,ot]=h.useState(0),[en,Dt]=h.useState(0),[rt,Wt]=h.useState("Can you explain this another way?"),[at,Et]=h.useState(!1),[xt,yt]=h.useState(!1),[Ue,Je]=h.useState([]),[Ae,ut]=h.useState(0),[Lt,bt]=h.useState(!1),[tn,nn]=h.useState(!1),[Ln,Mt]=h.useState(!1),[sn,Ut]=h.useState(null),[Mn,Rt]=h.useState(""),[on,rn]=h.useState(!1),[an,wt]=h.useState([]),[He,ze]=h.useState(null),[vt,ln]=h.useState({x:0,y:0,preferAbove:!0}),[mt,Ht]=h.useState(!1),[zt,It]=h.useState(""),[_t,At]=h.useState(!1),[qt,ht]=h.useState(!1),Ne=Y.useRef(null),he=Y.useRef(null),cn=Y.useRef(null),Ft=Y.useRef(null),se=Y.useRef(null),$t=Y.useRef(null),Gt=Y.useRef(null),gt=Y.useRef([]),Pt=Y.useRef([]),Qe=Y.useRef(null),dn=Y.useRef(!0),[Ve,Le]=Y.useState(!1),[un,Bt]=Y.useState(0),[Rn,Pe]=Y.useState(-1),[mn,jt]=Y.useState(!1),ce=Y.useRef(null),ee=Y.useRef(null),lt=Y.useRef(null),Xe=Y.useRef(!1),ft=Y.useRef(null),ke=Y.useRef(null),hn=Y.useRef(null),Me=Y.useRef({}),Ze=Y.useRef(!1),qe=Y.useRef({}),[pt,gn]=h.useState(null),[Ks,fn]=h.useState(!1),it="male",Kt=1,[Ys,pn]=h.useState(0),[Js,xn]=h.useState([]),[In,yn]=h.useState(!1),[_n,An]=h.useState("");h.useEffect(()=>{Fn(),setTimeout(()=>{ie(0)},2500)},[]),h.useEffect(()=>{(async()=>{var s,r,c,l,d,i;const n=new URLSearchParams(window.location.search);if(console.log("üîç Checking URL params:",window.location.search),console.log("üîç Payment param value:",n.get("payment")),n.get("payment")==="success"){if(sessionStorage.getItem("payment_processed")){console.log("‚è≠Ô∏è Payment already processed, skipping..."),window.history.replaceState({},"",window.location.pathname);return}console.log(`
‚úÖ ============ PAYMENT SUCCESS DETECTED ============`),console.log("‚è∞ Timestamp:",new Date().toISOString()),console.log("‚è≥ Waiting 3 seconds for webhook to process..."),sessionStorage.setItem("payment_processed","true"),await new Promise(u=>setTimeout(u,3e3)),console.log("üîÑ Calling supabase.auth.refreshSession()...");try{const{data:u,error:g}=await Xt.auth.refreshSession();if(g){console.error("‚ùå Session refresh FAILED"),console.error("‚ùå Error:",g.message),console.error("‚ùå Error details:",JSON.stringify(g,null,2)),sessionStorage.removeItem("payment_processed");return}console.log("‚úÖ Session refreshed successfully"),console.log("üë§ User data:",JSON.stringify((s=u.session)==null?void 0:s.user,null,2)),console.log("üì¶ User metadata:",JSON.stringify((c=(r=u.session)==null?void 0:r.user)==null?void 0:c.user_metadata,null,2)),console.log("üéØ is_ad_free value:",(i=(d=(l=u.session)==null?void 0:l.user)==null?void 0:d.user_metadata)==null?void 0:i.is_ad_free),window.history.replaceState({},"",window.location.pathname),console.log("‚úÖ Payment processed successfully without page reload")}catch(u){console.error("‚ùå Exception during session refresh"),console.error("‚ùå Error:",u.message),console.error("‚ùå Stack:",u.stack),sessionStorage.removeItem("payment_processed")}}})()},[]),h.useEffect(()=>{(async()=>{if(A)try{const n=await re(),r=(await Ns(A.id,n,M,B)).map(c=>({text:St(c.selected_text),explanation:c.explanation,id:c.id}));wt(r)}catch(n){console.error("Error loading explained sections:",n)}})()},[A,M,B]),h.useEffect(()=>{(async()=>{if(A)try{const n=await re(),s=await Ss(A.id,n,M,B);gn(s?s.rating:null)}catch(n){console.error("Error loading lesson rating:",n)}})()},[A,M,B]),h.useEffect(()=>{const e=parseInt($.get("module")),n=parseInt($.get("lesson"));e&&e!==M&&Fe(e),n&&n!==B&&Ge(n)},[$]),h.useEffect(()=>{if(dn.current){dn.current=!1;return}ce.current&&(ce.current.pause(),ce.current.currentTime=0,ce.current=null),ke.current&&(URL.revokeObjectURL(ke.current.url),ke.current=null),Object.values(Me.current).forEach(e=>{e&&e.url&&URL.revokeObjectURL(e.url)}),Me.current={},qe.current={},hn.current=null,Xe.current=!1,Le(!1),Bt(0),we([{type:"assistant",text:`Hello, I'm Will.
I'm here to answer any questions you may have on course content. Ask me to dive deeper into a topic or to phrase something differently.`,isComplete:!1}]),Ie(""),Qe.current&&(Qe.current.scrollTop=0),setTimeout(()=>{ie(0)},100)},[M,B]),h.useEffect(()=>{$t.current&&($t.current.scrollTop=$t.current.scrollHeight)},[ue]),h.useEffect(()=>{const e=()=>{var d,i,m;if(j||xt)return;const n=window.getSelection(),s=n==null?void 0:n.toString().trim(),r=n==null?void 0:n.anchorNode,c=((d=r==null?void 0:r.parentElement)==null?void 0:d.tagName)==="INPUT"||((i=r==null?void 0:r.parentElement)==null?void 0:i.closest("input")),l=(m=r==null?void 0:r.parentElement)==null?void 0:m.closest("[data-popup-notes]");!c&&!l&&!on&&(s&&s.length>0?(Rt(s),Ie(`Explain '${s}'`)):Te.startsWith("Explain '")&&(Ie(""),Rt("")))};return document.addEventListener("mouseup",e),document.addEventListener("selectionchange",e),()=>{document.removeEventListener("mouseup",e),document.removeEventListener("selectionchange",e)}},[Te,on,j,xt]),h.useEffect(()=>{const e=n=>{if(n.key==="Enter"&&Te.startsWith("Explain '")&&document.activeElement.tagName!=="INPUT"&&document.activeElement.tagName!=="TEXTAREA"&&!document.activeElement.isContentEditable){n.preventDefault();const s=document.querySelector("[data-chat-form]");s&&s.dispatchEvent(new Event("submit",{bubbles:!0,cancelable:!0}))}};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[Te]),h.useEffect(()=>{if(ye===null)return;const e=ue[ye];if(!e||e.isComplete)return;const n=e.text;let s=0,r=0;const c=setInterval(()=>{if(r>0){r--;return}s<n.length?(Ye(n.substring(0,s+1)),n[s]===`
`&&(r=15),(n[s]==="."||n[s]==="!"||n[s]==="?")&&(r=7),s++):(clearInterval(c),we(l=>l.map((d,i)=>i===ye?{...d,isComplete:!0}:d)),ie(null),Ye(""))},45);return()=>clearInterval(c)},[ye,ue]),h.useEffect(()=>{ne&&setTimeout(()=>{const n=Date.now()+2e3,s={startVelocity:25,spread:360,ticks:100,zIndex:55,gravity:.6,scalar:1.8,colors:["#EF0B72","#FF4D9E","#FF80B8"]};function r(l,d){return Math.random()*(d-l)+l}const c=setInterval(function(){const l=n-Date.now();if(l<=0)return clearInterval(c);const d=10*(l/2e3);En({...s,particleCount:d,origin:{x:r(.2,.4),y:Math.random()-.2}}),En({...s,particleCount:d,origin:{x:r(.6,.8),y:Math.random()-.2}})},400)},300)},[ne]),h.useEffect(()=>{if(!se.current||gt.current.length===0)return;const e={root:se.current,threshold:[0,.5,1],rootMargin:"0px"},n=new IntersectionObserver(s=>{let r=null,c=0;if(s.forEach(l=>{l.isIntersecting&&l.intersectionRatio>c&&(c=l.intersectionRatio,r=l.target)}),r){const l=gt.current.indexOf(r);l!==-1&&ot(l)}},e);return gt.current.forEach(s=>{s&&n.observe(s)}),requestAnimationFrame(()=>{if(se.current&&gt.current.length>0){se.current.scrollLeft,se.current.clientWidth;let s=0,r=0;gt.current.forEach((c,l)=>{if(c){const d=c.getBoundingClientRect(),i=se.current.getBoundingClientRect(),m=Math.max(d.left,i.left),u=Math.min(d.right,i.right),W=Math.max(0,u-m)/d.width;W>r&&(r=W,s=l)}}),ot(s)}}),()=>{n.disconnect()}},[V,M,B]);const Fn=async()=>{try{console.log("üîÑ Starting fetchLessonData...");const e=(A==null?void 0:A.id)||"temp-user-id",n=await re();console.log("üìù Using userId:",e,"courseId:",n);const{data:s}=await Xt.from("courses").select("title, name").eq("name",n).single();nt((s==null?void 0:s.title)||n),console.log("üìö Fetching lessons by module...");const r=await ks(n);console.log("‚úÖ Lessons data received:",r),r.module_1&&(console.log("üîç Module 1 lessons from database:"),Object.keys(r.module_1).forEach(l=>{const d=r.module_1[l];console.log(`  ${l}: ${d.lessonName||"No name"}`)})),de(r),console.log("üìã Fetching lessons metadata...");const c=await Cs(n);console.log("‚úÖ Metadata received:",c),De(c);try{console.log("‚úì Fetching completed lessons...");const l=await kn(e,n);console.log("‚úÖ Completed lessons received:",l),ae(l)}catch(l){console.error("Error fetching completed lessons:",l),ae([])}try{console.log("üîí Checking daily course completion limit...");const l=await Cn(e),d=await Nn(e);console.log("üìä Daily completion status:",{completedCount:l,completedCourseIds:d,currentCourseId:n}),pn(l),xn(d);const i=d.includes(n),m=l>=2&&!i;yn(m),m&&(An(Sn()),console.log("üö´ Daily limit reached! Next available:",Sn()))}catch(l){console.error("Error checking daily course limit:",l),yn(!1)}console.log("‚úÖ All data loaded, setting loading to false"),pe(!1)}catch(e){console.error("‚ùå Error fetching lesson data:",e),console.error("Error details:",e.message,e.stack),pe(!1)}},$n=()=>{var s;const e=`module_${M}`,n=`lesson_${B}`;return((s=V[e])==null?void 0:s[n])||[]},Pn=()=>{const e=[];for(let n=1;n<=M;n++){const s=`module_${n}`,r=V[s];if(!r)continue;const c=n===M?B-1:Object.keys(r).length;for(let l=1;l<=c;l++){const d=`lesson_${l}`,i=r[d];i&&Array.isArray(i)&&e.push({module:n,lesson:l,lessonName:i.lessonName||`Module ${n}, Lesson ${l}`,sections:i})}}return e},R=h.useMemo(()=>$n(),[V,M,B]),Re=R.lessonName||`Lesson ${B}`,kt=Y.useRef(0);kt.current++,kt.current===11&&(console.error("üî¥ INFINITE LOOP DETECTED! Render count:",kt.current),console.log("Current state values:",{loading:te,currentModule:M,currentLesson:B,isReading:Ve,groupedLessonsKeys:Object.keys(V).length}),console.log("‚ö†Ô∏è Component is re-rendering infinitely. Check useEffect dependencies.")),kt.current<=5&&console.log("üìñ Displaying lesson (render #"+kt.current+"):",{module:M,lesson:B,lessonName:Re,sectionsCount:Array.isArray(R)?R.length:0});const Bn=e=>{var n,s;if(!e)return console.log("generateQuestionForSection: no section"),null;if(console.log("generateQuestionForSection:",{content_type:e.content_type,level:(n=e.content)==null?void 0:n.level,suggested_question:e.suggested_question}),e.content_type==="heading"&&((s=e.content)==null?void 0:s.level)===2){if(e.suggested_question&&e.suggested_question.trim())return console.log("‚úÖ Returning question:",e.suggested_question),e.suggested_question;console.log("‚ö†Ô∏è H2 found but no suggested_question")}return null};h.useEffect(()=>{if(te||!R||R.length===0||!Qe.current){console.log("Observer setup skipped - missing requirements:",{loading:te,hasLessonSections:!!R,lessonSectionsLength:(R==null?void 0:R.length)||0,hasContentScrollRef:!!Qe.current});return}console.log("Setting up Intersection Observer for",R.length,"sections");const e=new IntersectionObserver(s=>{let r=null,c=1/0;s.forEach(d=>{var i;if(d.isIntersecting){const m=parseInt(d.target.dataset.sectionIndex),u=R[m],g=d.boundingClientRect,W=d.rootBounds;if(!W)return;if(u&&u.content_type==="heading"&&((i=u.content)==null?void 0:i.level)===2){const f=W.height*.5,C=g.top;if(C<=f){const X=Math.abs(C-f);X<c&&(c=X,r=m)}}}});const l=r;l!==null&&Dt(d=>{if(d!==l){const i=R[l],m=Bn(i);return Wt(m||"Can you explain this another way?"),l}return d})},{root:Qe.current,threshold:[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1]}),n=setTimeout(()=>{const s=Pt.current.filter(r=>r!==null);console.log("Observing",s.length,"section refs"),s.forEach(r=>{e.observe(r)})},100);return()=>{clearTimeout(n),e.disconnect()}},[R,M,B,te]);const On=async()=>{D(!0)},bn=async e=>{if(A)try{const n=await re();await Es(A.id,n,M,B,e),gn(e),fn(!0),setTimeout(()=>{fn(!1)},2e3)}catch(n){console.error("Error submitting lesson rating:",n)}},Dn=()=>{D(!1)},wn=async()=>{try{yt(!0),Je([]),Mt(!0),Ut(null);const e=await re(),n=await Ls(e,M,B);Mt(!1),n&&n.length>0?(Je(n),ut(0),bt(!1)):(console.warn(`No flashcards found for Module ${M}, Lesson ${B}`),Je([]))}catch(e){console.error("Error fetching flashcards:",e),Mt(!1),Ut("Failed to load flashcards. Please try again."),Je([])}},vn=()=>{nn(!0),setTimeout(()=>{yt(!1),nn(!1),bt(!1),ut(0),Ut(null),Mt(!1)},200)},Wn=()=>{bt(!Lt)},Un=()=>{Ae<Ue.length-1&&(bt(!1),ut(Ae+1))},Hn=()=>{Ae>0&&(bt(!1),ut(Ae-1))},Yt=()=>{$e(!0),setTimeout(()=>{je(!1),$e(!1),Z("/")},200)},jn=()=>{window.open("https://www.linkedin.com/in/me/edit/forms/education/new/","_blank"),Yt()},zn=async()=>{console.log("üéØ handleKnowledgeCheckPass called"),console.log("üìç Current lesson:",{module:M,lesson:B});try{const e=(A==null?void 0:A.id)||"temp-user-id",n=await re();console.log("üíæ Marking lesson complete for userId:",e),await Ms(e,n,M,B),console.log("‚úÖ Lesson marked as complete in database");const s=G.length===0;console.log("üîç Is first lesson?",s,"(Current completed count:",G.length,")");try{const r=await kn(e,n);console.log("‚úÖ Completed lessons refreshed in LearningHub:",r),console.log("üìä New completed lessons count:",r.length),ae(r);const c=await Rs(e,n);if(console.log("üéì Course completion check:",c),c){console.log("üéâ Course completed! Marking in course_completions table..."),await Is(e,n);const l=await Cn(e),d=await Nn(e);pn(l),xn(d),console.log("‚úÖ Course completion recorded. Total courses completed today:",l)}}catch(r){console.error("‚ùå Error refreshing completed lessons:",r)}D(!1),s?(console.log("üéâ First lesson complete! Showing LinkedIn modal"),je(!0)):(console.log("‚û°Ô∏è Navigating to Progress Hub"),Z("/"))}catch(e){console.error("‚ùå Error marking lesson complete:",e),D(!1),Z("/")}},qn=async e=>{if(e.preventDefault(),!Te.trim())return;const n=Te,s=Mn,r=[...ue,{type:"user",text:n}];we(r),Ie(""),_e(!0);try{const c=R.length>0?`
Lesson: ${Re}
Module: ${M}

Sections:
${R.map(i=>`
Title: ${i.title}
Content: ${typeof i.content=="string"?i.content:JSON.stringify(i.content)}
`).join(`
---
`)}
      `.trim():"",d=await(await fetch("https://ignite-education-api.onrender.com/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:r,lessonContext:c})})).json();if(_e(!1),d.success){const i=ue.length+1;if(we(m=>[...m,{type:"assistant",text:d.response,isComplete:!1}]),ie(i),s&&n.startsWith("Explain '"))try{const m=await re(),u=St(s),g=await Ts(A.id,m,M,B,u,d.response);wt(W=>[...W,{text:u,explanation:d.response,id:g.id}]),Rt("")}catch(m){console.error("Error saving explained section:",m);const u=St(s);wt(g=>[...g,{text:u,explanation:d.response,id:Date.now()}]),Rt("")}}else throw new Error(d.error||"Failed to get response")}catch(c){console.error("Error sending message:",c),_e(!1);const l=ue.length+1;we(d=>[...d,{type:"assistant",text:"Sorry, I encountered an error. Please try again! üòä",isComplete:!1}]),ie(l)}},Gn=async e=>{try{await _s(e),wt(n=>n.filter(s=>s.id!==e)),he.current&&(clearTimeout(he.current),he.current=null),ze(null),At(!1)}catch(n){console.error("Error deleting explained section:",n)}},Kn=e=>{It(e),Ht(!0),setTimeout(()=>{if(Ft.current){Ft.current.focus();const n=document.createRange(),s=window.getSelection();n.selectNodeContents(Ft.current),n.collapse(!1),s.removeAllRanges(),s.addRange(n)}},10)},Yn=async e=>{try{await As(e,zt),wt(n=>n.map(s=>s.id===e?{...s,explanation:zt}:s)),he.current&&(clearTimeout(he.current),he.current=null),Ht(!1),It(""),At(!1),ze(null)}catch(n){console.error("Error updating explained section:",n)}},Jn=()=>{Ht(!1),It("")},Qn=async e=>{if(qt&&Ne.current){Ne.current.pause(),Ne.current=null,ht(!1);return}try{ht(!0);const n=e.replace(/\*\*(.+?)\*\*/g,"$1").replace(/\*(.+?)\*/g,"$1").trim(),s=await fetch("https://ignite-education-api.onrender.com/api/text-to-speech",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:n,voiceGender:it})});if(!s.ok)throw new Error("Failed to generate speech");const r=await s.blob(),c=URL.createObjectURL(r),l=new Audio(c);Ne.current=l,l.onended=()=>{ht(!1),Ne.current=null,URL.revokeObjectURL(c)},l.onerror=()=>{ht(!1),Ne.current=null,URL.revokeObjectURL(c)},l.playbackRate=Kt,await l.play()}catch(n){console.error("Error reading note aloud:",n),ht(!1),Ne.current=null}},Vn=e=>{se.current&&(ve(!0),o(e.pageX-se.current.offsetLeft),k(se.current.scrollLeft))},Xn=e=>{if(!We||!se.current)return;e.preventDefault();const s=(e.pageX-se.current.offsetLeft-a)*2;se.current.scrollLeft=y-s},Zn=()=>{ve(!1)},es=()=>{ve(!1)},ts=()=>{if(!se.current||J.length===0)return;const e=se.current.scrollLeft,n=16;let s=0,r=0;for(let c=0;c<J.length;c++){const l=J[c],d=Se(l.module_number,l.lesson_number),i=J.findIndex(g=>!Se(g.module_number,g.lesson_number)),u=d||c===i?390:346.06;if(e<s+u/2){r=c;break}s+=u+n,c===J.length-1&&(r=c)}ot(r)},ns=()=>{if(!se.current||J.length===0)return;const e=J.findIndex(n=>!Se(n.module_number,n.lesson_number));if(e!==-1){let s=0;for(let r=0;r<e;r++){const c=J[r],i=Se(c.module_number,c.lesson_number)||r===e?390:346.06;s+=i+16}se.current.scrollTo({left:s,behavior:"smooth"}),ot(e)}},Jt=()=>{x(!0),setTimeout(()=>{v(!1),x(!1),F(null),p(!1)},200)},ss=async()=>{if(!A){alert("Please sign in to upgrade to ad-free");return}v(!0),p(!0);try{const n=await(await fetch("https://ignite-education-api.onrender.com/api/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:A.id})})).json();if(n.clientSecret)F(n.clientSecret),p(!1);else throw new Error("Failed to create checkout session")}catch(e){console.error("Error creating checkout session:",e),alert("Failed to start upgrade process. Please try again."),Jt()}};h.useEffect(()=>{let e=null;return(async()=>{if(b&&Gt.current)try{e=await(await Gs).initEmbeddedCheckout({clientSecret:b}),e.mount(Gt.current)}catch(s){console.error("Error mounting Stripe checkout:",s),p(!1),alert("Failed to load payment form. Please try again.")}})(),()=>{e&&e.destroy()}},[b]);const os=()=>{let e=0;return Object.keys(V).forEach(n=>{const s=V[n],r=Object.keys(s).filter(c=>c.startsWith("lesson_"));e+=r.length}),e},rs=()=>{let e=0;for(let s=1;s<M;s++){const r=`module_${s}`;if(V[r]){const c=Object.keys(V[r]).filter(l=>l.startsWith("lesson_"));e+=c.length}}const n=`module_${M}`;if(V[n]){const s=Object.keys(V[n]).filter(r=>r.startsWith("lesson_")).map(r=>parseInt(r.split("_")[1])).filter(r=>r<B);e+=s.length}return e},as=()=>{const e=os();if(e===0)return 0;const n=rs();return Math.round(n/e*100)};Object.keys(V).length>0&&as();const Se=(e,n)=>G.some(s=>s.module_number===e&&s.lesson_number===n),ls=()=>le.length===0?[]:le.sort((e,n)=>e.module_number!==n.module_number?e.module_number-n.module_number:e.lesson_number-n.lesson_number),J=Object.keys(V).length>0?ls():[];h.useEffect(()=>{if(!se.current||J.length===0||te)return;const e=J.findIndex(n=>!Se(n.module_number,n.lesson_number));if(console.log("üéØ LearningHub - Attempting to scroll to current lesson index:",e),console.log("üìö LearningHub - Total lessons:",J.length),console.log("üìù LearningHub - All lessons:",J.map(n=>`M${n.module_number}L${n.lesson_number}`)),e!==-1){const n=se.current,s=16;let r=0;for(let c=0;c<e;c++){const l=J[c],m=Se(l.module_number,l.lesson_number)||c===e?390:346.06;r+=m+s}console.log("üìç LearningHub - Setting initial scroll position:",r),n.scrollLeft=r,ot(e),Et(!0)}else Et(!0)},[J,te,M,B,G]),h.useEffect(()=>{if(!se.current||!at)return;const e=()=>{se.current&&T(se.current.clientWidth)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[J.length,at]);const et=e=>{var n,s;if(e.content_type==="heading"){const r=((n=e.content)==null?void 0:n.text)||e.title||"";return St(r)}if(e.content_type==="paragraph"){const r=typeof e.content=="string"?e.content:((s=e.content)==null?void 0:s.text)||e.content_text||"";return St(r)}return""},is=e=>e?e.split(`
`).map((n,s)=>{const r=n.match(/^[‚Ä¢\-\*]\s+(.+?):\s*(.*)$/),c=n.match(/^[‚Ä¢\-\*]\s+(.+?)\s+-\s+(.*)$/),l=n.match(/^(\d+)\.\s+(.+?):\s*(.*)$/),d=n.match(/^(\d+)\.\s+(.+?)\s+-\s+(.*)$/);if(r){const i=r[1].replace(/\*\*/g,""),m=r[2].replace(/\*\*/g,"");return t.jsxs("p",{className:s>0?"mt-2":"",children:[t.jsxs("span",{children:[r[0].charAt(0)," "]}),t.jsxs("strong",{className:"font-semibold",children:[i,":"]}),t.jsxs("span",{children:[" ",m]})]},s)}else if(c){const i=c[1].replace(/\*\*/g,""),m=c[2].replace(/\*\*/g,"");return t.jsxs("p",{className:s>0?"mt-2":"",children:[t.jsxs("span",{children:[c[0].charAt(0)," "]}),t.jsx("strong",{className:"font-semibold",children:i}),t.jsxs("span",{children:[" - ",m]})]},s)}else if(l){const i=l[2].replace(/\*\*/g,""),m=l[3].replace(/\*\*/g,"");return t.jsxs("p",{className:s>0?"mt-2":"",children:[t.jsxs("span",{children:[l[1],". "]}),t.jsxs("strong",{className:"font-semibold",children:[i,":"]}),t.jsxs("span",{children:[" ",m]})]},s)}else if(d){const i=d[2].replace(/\*\*/g,""),m=d[3].replace(/\*\*/g,"");return t.jsxs("p",{className:s>0?"mt-2":"",children:[t.jsxs("span",{children:[d[1],". "]}),t.jsx("strong",{className:"font-semibold",children:i}),t.jsxs("span",{children:[" - ",m]})]},s)}else{const i=n.split(/(\*\*.*?\*\*|\*.*?\*|DNA|RNA|Proteins)/g);return t.jsx("p",{className:s>0?"mt-2":"",children:i.map((m,u)=>{if(m.startsWith("**")&&m.endsWith("**")&&m.length>4){const g=m.slice(2,-2).trim();return t.jsx("strong",{className:"font-semibold",children:g},u)}else if(m.startsWith("*")&&m.endsWith("*")&&m.length>2&&!m.startsWith("**")){const g=m.slice(1,-1).trim();return t.jsx("em",{className:"italic",children:g},u)}else if(m==="DNA"||m==="RNA"||m==="Proteins")return t.jsx("strong",{className:"font-semibold",children:m},u);return t.jsx("span",{children:m},u)})},s)}}):null,tt=(e,n,s=null,r=!1)=>{if(!e)return null;const c=e.split(/(\s+)/),l=[];let d=n;return c.forEach((i,m)=>{let u=0;for(let I=0;I<m;I++)u+=c[I].length;const g=u,W=u+i.length;let U=!1,f=null;if(an.forEach(I=>{const z=e.indexOf(I.text);if(z!==-1){const N=z+I.text.length;g<N&&W>z&&(U=!0,f=I.id)}}),!i||/^\s+$/.test(i)){U?l.push(t.jsx("span",{className:"bg-pink-100 cursor-pointer hover:bg-pink-200",style:{backgroundColor:"#fce7f3"},onMouseEnter:I=>{if(he.current&&(clearTimeout(he.current),he.current=null),!_t)if(He!==f){ze(f);const z=I.currentTarget.getBoundingClientRect(),N=z.left+z.width/2,O=z.top;ln({x:N,y:O})}else ze(f)},onMouseLeave:()=>{_t||(he.current=setTimeout(()=>{ze(null)},200))},children:i},`space-${m}`)):l.push(t.jsx("span",{children:i},`space-${m}`));return}const C=i,K=!r&&Ve&&(s==="title"&&mn||s!=="title"&&!mn&&s===un)&&Rn===d;let P="transition-all duration-200",oe={};K?oe={backgroundColor:"#FDE7F4",borderRadius:"2px",boxShadow:"0 0 0 3px #FDE7F4"}:U&&(P+=" bg-pink-100 cursor-pointer hover:bg-pink-200",oe={}),l.push(t.jsx("span",{className:P,style:oe,onMouseEnter:U?I=>{if(he.current&&(clearTimeout(he.current),he.current=null),!_t)if(He!==f){ze(f);const z=I.currentTarget.getBoundingClientRect(),N=z.left+z.width/2,O=z.bottom,_=z.top,be=500,Q=_,xe=window.innerHeight-O,Be=Q>be||Q>xe;ln({x:N,y:Be?_:O,preferAbove:Be}),cn.current=I.currentTarget}else ze(f)}:void 0,onMouseLeave:U?()=>{_t||(he.current=setTimeout(()=>{ze(null),cn.current=null},300))}:void 0,children:C},`word-${m}-${d}`)),d++}),l},Qt=async e=>{var d,i,m;const n=performance.now();if(console.log(`üéØ [${n.toFixed(0)}ms] narrateSection(${e}) ENTERED`),e>=R.length){console.log("‚úÖ Finished narrating all sections"),Le(!1),Bt(0),Pe(-1),jt(!1),Xe.current=!1,ee.current&&(cancelAnimationFrame(ee.current),ee.current=null);return}const s=R[e],r=et(s);if(!r||r.length===0){console.log(`‚è≠Ô∏è Skipping empty section ${e}`),await Qt(e+1);return}console.log(`üìñ [${performance.now().toFixed(0)}ms] Narrating section ${e} (${s.content_type}): ${r.substring(0,50)}...`);const c=s.content_type==="heading"?((d=s.content)==null?void 0:d.level)||2:null;if(c===2||c===3){const u=R.findIndex(g=>{var W;return g.content_type==="heading"&&(((W=g.content)==null?void 0:W.level)||2)===2});e!==u&&cs(e)}try{let u,g;const W=performance.now(),U=Object.keys(Me.current),f=Object.keys(qe.current);console.log(`üíæ [${W.toFixed(0)}ms] Batch cache has sections: [${U.join(", ")}], Pending: [${f.join(", ")}]`);const C=Me.current[e];if(C){const N=performance.now();console.log(`‚ö° [${N.toFixed(0)}ms] BATCH CACHE HIT for section ${e} (readyState: ${C.audio.readyState})`),u=C.url,g=C.audio,C.wordTimestamps&&(lt.current=C.wordTimestamps,console.log(`üìù Retrieved ${C.wordTimestamps.length} word timestamps from cache`)),delete Me.current[e],delete qe.current[e],ce.current=g}else if(qe.current[e]){const N=performance.now();console.log(`‚è≥ [${N.toFixed(0)}ms] Waiting for prefetch of section ${e} to complete...`);try{await qe.current[e];const O=performance.now();console.log(`‚úÖ [${O.toFixed(0)}ms] Prefetch completed (waited: ${(O-N).toFixed(0)}ms)`);const _=Me.current[e];if(_)u=_.url,g=_.audio,_.wordTimestamps&&(lt.current=_.wordTimestamps,console.log(`üìù Retrieved ${_.wordTimestamps.length} word timestamps from cache`)),delete Me.current[e],delete qe.current[e],ce.current=g;else throw new Error("Prefetch completed but audio not in cache")}catch(O){console.log("‚ö†Ô∏è Prefetch failed, falling back to on-demand fetch:",O.message)}}else if(ke.current&&ke.current.sectionIndex===e){const N=performance.now();console.log(`‚ö° [${N.toFixed(0)}ms] SINGLE CACHE HIT for section ${e}`),u=ke.current.url,g=ke.current.audio,ke.current=null,ce.current=g}if(!g){const N=performance.now();console.log(`‚ùå [${N.toFixed(0)}ms] CACHE MISS - Fetching section ${e} on-demand`),ft.current=new AbortController;const O=ft.current,_=await fetch("https://ignite-education-api.onrender.com/api/text-to-speech-timestamps",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:r,voiceGender:it}),signal:O.signal});if(!_.ok){const Oe=await _.text();throw console.error("‚ùå Section narration API error:",_.status,Oe),new Error(`Failed to generate speech: ${_.status} - ${Oe}`)}const be=performance.now();console.log(`üì• [${be.toFixed(0)}ms] TTS API response received (took: ${(be-N).toFixed(0)}ms)`);const Q=await _.json();console.log("‚úÖ Section narration API response received:",{hasAudio:!!Q.audio_base64,hasAlignment:!!Q.alignment,alignmentChars:(m=(i=Q.alignment)==null?void 0:i.characters)==null?void 0:m.length});const xe=atob(Q.audio_base64),Be=new ArrayBuffer(xe.length),hs=new Uint8Array(Be);for(let Oe=0;Oe<xe.length;Oe++)hs[Oe]=xe.charCodeAt(Oe);const gs=new Blob([Be],{type:"audio/mpeg"});if(u=URL.createObjectURL(gs),Q.alignment){const Oe=Ot(r,Q.alignment.characters,Q.alignment.character_start_times_seconds,Q.alignment.character_end_times_seconds);lt.current=Oe,console.log(`üìù Converted ${Oe.length} word timestamps for section ${e}`)}g=new Audio(u),ce.current=g,console.log(`üéµ [${performance.now().toFixed(0)}ms] Audio object created from blob`)}g.onended=async()=>{const N=performance.now();if(console.log(`‚è±Ô∏è [${N.toFixed(0)}ms] Section ${e} ENDED`),URL.revokeObjectURL(u),ce.current!==g){console.log(`Section ${e} audio is no longer active, skipping continuation`);return}if(!Xe.current){const O=performance.now();console.log(`üîÑ [${O.toFixed(0)}ms] Starting section ${e+1} (gap: ${(O-N).toFixed(0)}ms)`),await Qt(e+1);const _=performance.now();console.log(`‚ñ∂Ô∏è [${_.toFixed(0)}ms] Section ${e+1} PLAYING (took: ${(_-O).toFixed(0)}ms)`)}},g.onerror=N=>{console.error("Audio playback error:",N),URL.revokeObjectURL(u),Le(!1)},g.playbackRate=Kt;const X=performance.now();console.log(`üé¨ [${X.toFixed(0)}ms] Calling audio.play() for section ${e} (readyState: ${g.readyState})`),await g.play();const K=performance.now();console.log(`‚úÖ [${K.toFixed(0)}ms] audio.play() completed (took: ${(K-X).toFixed(0)}ms) - SECTION ${e} NOW PLAYING`),console.log(`‚è∞ Total time from narrateSection entry to playback: ${(K-n).toFixed(0)}ms`),Le(!0),Bt(e);const P=R.slice(0,e).map(N=>et(N)).join(" ").split(/\s+/).filter(N=>N.length>0).length,oe=r.split(/\s+/).filter(N=>N.length>0).length;ee.current&&cancelAnimationFrame(ee.current);const I=()=>{const N=lt.current;if(!N||N.length===0){console.warn("‚ö†Ô∏è No word timestamps available for section",e);return}console.log(`üìù Section ${e}: Using ${N.length} precise word timestamps`),Pe(P);const O=()=>{if(!g||g.paused||g.ended)return;const _=g.currentTime;let be=!1;for(let Q=0;Q<N.length;Q++){const xe=N[Q];if(_>=xe.start&&_<xe.end){Pe(P+Q),be=!0;break}}if(!be&&_>=N[N.length-1].end){Pe(-1),ee.current=null;return}ee.current=requestAnimationFrame(O)};ee.current=requestAnimationFrame(O)};g.duration&&!isNaN(g.duration)?I():g.addEventListener("loadedmetadata",I,{once:!0});const z=e+1;if(z<R.length){const N=R[z],O=et(N);O&&O.length>0&&(console.log(`‚ö° Prefetching section ${z}...`),hn.current=(async()=>{try{const _=await fetch("https://ignite-education-api.onrender.com/api/text-to-speech",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:O,voiceGender:it})});if(_.ok){const be=await _.blob(),Q=URL.createObjectURL(be),xe=new Audio(Q);ce.current===g?(ke.current&&URL.revokeObjectURL(ke.current.url),ke.current={url:Q,audio:xe,sectionIndex:z},console.log(`‚ö° Section ${z} prefetched successfully`)):URL.revokeObjectURL(Q)}}catch(_){console.log("Prefetch failed (non-critical):",_.message)}})())}}catch(u){if(u.name==="AbortError"){console.log(`Section ${e} narration cancelled`);return}console.error("Error narrating section:",u),Le(!1)}},cs=e=>{if(!Qe.current||!Pt.current[e])return;const n=Pt.current[e],s=Qe.current,l=n.offsetTop-32,d=s.scrollTop,i=l-d,m=1200;let u=null;const g=U=>U<.5?4*U*U*U:1-Math.pow(-2*U+2,3)/2,W=U=>{u||(u=U);const f=U-u,C=Math.min(f/m,1),X=g(C);s.scrollTop=d+i*X,C<1&&requestAnimationFrame(W)};requestAnimationFrame(W)},ds=async()=>{var e,n;console.log(`üéØ [ENTRY] narrateLessonTitle called for: ${Re}`);try{console.log(`üìñ Narrating lesson title: ${Re}`),ft.current=new AbortController;const s=ft.current;console.log("üåê [FETCH] Starting API call to /api/text-to-speech-timestamps..."),console.log("üì§ [FETCH] Request body:",{text:Re,voiceGender:it});const r=await fetch("https://ignite-education-api.onrender.com/api/text-to-speech-timestamps",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:Re,voiceGender:it}),signal:s.signal});if(console.log("üì° [FETCH] API response received, status:",r.status),!r.ok){const f=await r.text();throw console.error("‚ùå Title narration API error:",r.status,f),new Error(`Failed to generate speech for lesson title: ${r.status} - ${f}`)}const c=await r.json();console.log("‚úÖ Title narration API response received:",{hasAudio:!!c.audio_base64,hasAlignment:!!c.alignment,alignmentChars:(n=(e=c.alignment)==null?void 0:e.characters)==null?void 0:n.length});const l=atob(c.audio_base64),d=new ArrayBuffer(l.length),i=new Uint8Array(d);for(let f=0;f<l.length;f++)i[f]=l.charCodeAt(f);const m=new Blob([d],{type:"audio/mpeg"}),u=URL.createObjectURL(m);if(c.alignment){const f=Ot(Re,c.alignment.characters,c.alignment.character_start_times_seconds,c.alignment.character_end_times_seconds);lt.current=f,console.log(`üìù Converted ${f.length} word timestamps for lesson title`)}const g=new Audio(u);ce.current=g,g.onended=async()=>{const f=performance.now();if(console.log(`‚è±Ô∏è [${f.toFixed(0)}ms] TITLE ENDED`),URL.revokeObjectURL(u),jt(!1),ce.current!==g){console.log("Title audio is no longer active, skipping continuation");return}if(!Xe.current){const C=performance.now();console.log(`üîÑ [${C.toFixed(0)}ms] Starting section 0 (gap: ${(C-f).toFixed(0)}ms)`),await Qt(0);const X=performance.now();console.log(`‚ñ∂Ô∏è [${X.toFixed(0)}ms] Section 0 PLAYING (took: ${(X-C).toFixed(0)}ms)`)}},g.onerror=f=>{console.error("Audio playback error:",f),URL.revokeObjectURL(u),Le(!1)},g.playbackRate=Kt;try{console.log("üé¨ Attempting to play title audio..."),await g.play(),console.log("‚úÖ Title audio playing successfully")}catch(f){throw console.error("‚ùå Failed to play title audio:",f),URL.revokeObjectURL(u),Le(!1),f}jt(!0);const W=Re.split(/\s+/).filter(f=>f.length>0),U=()=>{const f=lt.current;if(!f||f.length===0){console.warn("‚ö†Ô∏è No word timestamps available for title");return}console.log(`üìù Title: Using ${f.length} precise word timestamps`),Pe(0),ee.current&&cancelAnimationFrame(ee.current);const C=()=>{if(!g||g.paused||g.ended)return;const X=g.currentTime;let K=!1;for(let P=0;P<f.length;P++){const oe=f[P];if(X>=oe.start&&X<oe.end){Pe(P),K=!0;break}}if(!K&&X>=f[f.length-1].end){Pe(-1),jt(!1),ee.current=null;return}ee.current=requestAnimationFrame(C)};ee.current=requestAnimationFrame(C)};g.duration&&!isNaN(g.duration)?U():g.addEventListener("loadedmetadata",U,{once:!0}),R&&R.length>0&&[0,1,2,3,4,5].filter(C=>C<R.length).forEach(C=>{const X=R[C],K=et(X);K&&K.length>0&&(console.log(`‚ö° Prefetching section ${C} during title...`),qe.current[C]||(qe.current[C]=new Promise((P,oe)=>{fetch("https://ignite-education-api.onrender.com/api/text-to-speech-timestamps",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:K,voiceGender:it})}).then(async I=>{if(I.ok)return I.json();const z=await I.text();throw console.error(`‚ùå Title prefetch section ${C} API error:`,I.status,z),new Error(`Prefetch failed: ${I.status}`)}).then(I=>{const z=atob(I.audio_base64),N=new ArrayBuffer(z.length),O=new Uint8Array(N);for(let Be=0;Be<z.length;Be++)O[Be]=z.charCodeAt(Be);const _=new Blob([N],{type:"audio/mpeg"}),be=URL.createObjectURL(_),Q=new Audio(be);let xe=null;I.alignment&&(xe=Ot(K,I.alignment.characters,I.alignment.character_start_times_seconds,I.alignment.character_end_times_seconds)),Me.current[C]?(URL.revokeObjectURL(be),P()):(Q.addEventListener("canplaythrough",()=>{Me.current[C]={url:be,audio:Q,wordTimestamps:xe,sectionIndex:C},console.log(`‚úÖ Section ${C} prefetched during title (readyState: ${Q.readyState}, ${(xe==null?void 0:xe.length)||0} timestamps)`),P()},{once:!0}),Q.addEventListener("error",()=>{console.log(`‚ùå Section ${C} audio load error during title`),oe(new Error("Audio load failed"))},{once:!0}),Q.load())}).catch(I=>{console.log(`Title prefetch section ${C} failed:`,I.message),oe(I)})})))})}catch(s){if(s.name==="AbortError"){console.log("Lesson title narration cancelled");return}console.error("Error narrating lesson title:",s),Le(!1)}},us=()=>{if(!R||R.length===0)return;[0,1,2,3,4,5].filter(n=>n<R.length).forEach(n=>{const s=R[n],r=et(s);r&&r.length>0&&(console.log(`‚ö° Starting upfront prefetch for section ${n}`),qe.current[n]=new Promise((c,l)=>{fetch("https://ignite-education-api.onrender.com/api/text-to-speech-timestamps",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:r,voiceGender:it})}).then(async d=>{if(d.ok)return d.json();const i=await d.text();throw console.error(`‚ùå Prefetch section ${n} API error:`,d.status,i),new Error(`Prefetch failed: ${d.status}`)}).then(d=>{const i=atob(d.audio_base64),m=new ArrayBuffer(i.length),u=new Uint8Array(m);for(let C=0;C<i.length;C++)u[C]=i.charCodeAt(C);const g=new Blob([m],{type:"audio/mpeg"}),W=URL.createObjectURL(g),U=new Audio(W);let f=null;d.alignment&&(f=Ot(r,d.alignment.characters,d.alignment.character_start_times_seconds,d.alignment.character_end_times_seconds)),U.addEventListener("canplaythrough",()=>{Me.current[n]={url:W,audio:U,wordTimestamps:f,sectionIndex:n},console.log(`‚úÖ Section ${n} prefetched and cached (readyState: ${U.readyState}, ${(f==null?void 0:f.length)||0} timestamps)`),c()},{once:!0}),U.addEventListener("error",()=>{console.log(`‚ùå Section ${n} audio load error`),l(new Error("Audio load failed"))},{once:!0}),U.load()}).catch(d=>{console.log(`Prefetch section ${n} failed:`,d.message),l(d)})}))})},ms=async()=>{console.log("üîµ handleReadAloud called, isHandlingReadAloud:",Ze.current,"isReading:",Ve);const e=Date.now();if(Ze.current>0&&e-Ze.current<500){console.warn("‚ö†Ô∏è handleReadAloud called too quickly, ignoring (debounce). Time since last call:",e-Ze.current,"ms");return}Ze.current=e;try{if(Ve&&ce.current){ft.current&&ft.current.abort();const n=ce.current;n.pause(),n.paused||(console.warn("Audio pause failed - forcing pause state"),n.pause()),ee.current&&(cancelAnimationFrame(ee.current),ee.current=null),Pe(-1),jt(!1),Le(!1),Xe.current=!0,Ze.current=0;return}if(ce.current&&!Ve&&Xe.current){const n=ce.current;n.play(),Le(!0),Xe.current=!1;const s=lt.current;if(s&&s.length>0){const r=R.slice(0,un).map(l=>et(l)).join(" ").split(/\s+/).filter(l=>l.length>0).length;ee.current&&cancelAnimationFrame(ee.current);const c=()=>{if(!n||n.paused||n.ended)return;const l=n.currentTime;let d=!1;for(let i=0;i<s.length;i++){const m=s[i];if(l>=m.start&&l<m.end){Pe(r+i),d=!0;break}}if(!d&&l>=s[s.length-1].end){Pe(-1),ee.current=null;return}ee.current=requestAnimationFrame(c)};ee.current=requestAnimationFrame(c)}Ze.current=0;return}console.log("üé¨ Starting narration from beginning"),Le(!0),Xe.current=!1,Bt(0),us(),ds(),console.log("üîµ handleReadAloud completed, narration started")}catch(n){console.error("Error in handleReadAloud:",n),Ze.current=0,Le(!1)}};if(h.useEffect(()=>()=>{ce.current&&(ce.current.pause(),ce.current=null),Ne.current&&(Ne.current.pause(),Ne.current=null),ke.current&&(URL.revokeObjectURL(ke.current.url),ke.current=null),Object.values(Me.current).forEach(e=>{e&&e.url&&URL.revokeObjectURL(e.url)}),Me.current={},ee.current&&(cancelAnimationFrame(ee.current),ee.current=null)},[]),h.useEffect(()=>{!He&&Ne.current&&(Ne.current.pause(),Ne.current=null,ht(!1))},[He]),te)return t.jsx(xs,{});let Ct=!1,Vt="prerequisite",Nt=null;if(!te&&le.length>0&&G!==null){const e=[...le].sort((n,s)=>n.module_number!==s.module_number?n.module_number-s.module_number:n.lesson_number-s.lesson_number);if(In)console.log("üö´ LESSON LOCKED - Daily course completion limit reached (2 courses/day)"),Ct=!0,Vt="daily_limit",Nt=e[0];else{const n=e.findIndex(s=>s.module_number===M&&s.lesson_number===B);if(console.log("üîí Lesson Lock Check:"),console.log("  Current Module/Lesson:",M,B),console.log("  Requested Lesson Index:",n),console.log("  Completed Lessons:",G.map(s=>`M${s.module_number}L${s.lesson_number}`).join(", ")),n>0){const s=e[n-1];console.log("  Previous Lesson:",`M${s.module_number}L${s.lesson_number}`);const r=Se(s.module_number,s.lesson_number);if(console.log("  Is Previous Completed?",r),r)console.log("  ‚úÖ LESSON UNLOCKED - previous lesson is completed");else{console.log("  ‚ùå LESSON LOCKED - previous lesson not completed"),Ct=!0,Vt="prerequisite";const c=e.findIndex(l=>!Se(l.module_number,l.lesson_number));Nt=e[c!==-1?c:0]}}else console.log("  ‚úÖ LESSON UNLOCKED - this is the first lesson")}}return!R||R.length===0?t.jsxs("div",{className:"h-screen bg-black text-white flex items-center justify-center flex-col gap-4",children:[t.jsx("div",{className:"text-xl",children:"Lesson not found"}),t.jsx("button",{onClick:()=>Z("/"),className:"px-6 py-2 bg-purple-600 rounded-lg hover:bg-purple-700 transition",children:"Back to Progress Hub"})]}):t.jsxs(t.Fragment,{children:[t.jsx("style",{children:`
        @keyframes slideUpFade {
          from {
            opacity: 0;
            transform: translateY(10px) translateX(-50%);
          }
          to {
            opacity: 1;
            transform: translateY(0) translateX(-50%);
          }
        }
      `}),t.jsxs("div",{className:"h-screen bg-black text-white flex",style:{fontFamily:"Geist, -apple-system, BlinkMacSystemFont, sans-serif"},children:[t.jsxs("div",{className:"bg-black border-r border-gray-800 flex flex-col h-screen overflow-hidden",style:{width:"507.1px",minWidth:"507.1px"},children:[t.jsxs("div",{className:"flex-shrink-0 px-8",style:{paddingTop:"19.38px",paddingBottom:"5px"},children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsx("div",{className:"w-auto cursor-pointer",style:{backgroundImage:"url(https://yjvdakdghkfnlhdpbocg.supabase.co/storage/v1/object/public/assets/ignite_Logo_MV_4.png)",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"left center",width:"108.8px",height:"36px",marginBottom:"12px",marginLeft:"-5.44px"},onClick:()=>Z("/")})}),t.jsx("h2",{className:"font-semibold",style:{letterSpacing:"0.011em",fontSize:"27px",marginBottom:"0.72px"},children:H})]}),t.jsxs("div",{className:"flex-shrink-0 px-8 relative",style:{paddingTop:"0px",paddingBottom:"4px"},children:[t.jsx("h3",{className:"font-semibold",style:{fontSize:"19px",marginBottom:"2px"},children:J.length>0&&me<J.length&&J[me]?(()=>{const e=J[me],n=Se(e.module_number,e.lesson_number),s=J.findIndex(c=>!Se(c.module_number,c.lesson_number)),r=me===s;return n?"Completed Lesson":r?"Current Lesson":"Upcoming Lesson"})():"Upcoming Lessons"}),t.jsx("div",{ref:se,className:"overflow-x-auto overflow-y-hidden select-none",style:{scrollbarWidth:"none",msOverflowStyle:"none",scrollBehavior:"smooth",cursor:We?"grabbing":"grab",paddingBottom:"9px",scrollSnapType:"x mandatory",opacity:at?1:0,visibility:at?"visible":"hidden",transition:"opacity 0.3s ease-in"},onMouseDown:Vn,onMouseMove:Xn,onMouseUp:Zn,onMouseLeave:es,onScroll:ts,children:t.jsx("div",{className:"flex gap-4",style:{minHeight:"100px",height:"100px",paddingRight:S>0?`${Math.max(0,S-390-16)}px`:"0px"},children:J.length>0?J.map((e,n)=>{const s=Se(e.module_number,e.lesson_number),r=J.findIndex(l=>!Se(l.module_number,l.lesson_number)),c=n===r;return t.jsxs("div",{ref:l=>gt.current[n]=l,className:"relative flex items-center gap-3",style:{width:s||c?"390px":"346.06px",minWidth:s||c?"390px":"346.06px",flexShrink:0,paddingTop:"4px",paddingRight:"5.618px",paddingBottom:"5.618px",paddingLeft:"14px",borderRadius:"0.3rem",background:"#7714E0",height:"90px",scrollSnapAlign:"start",scrollSnapStop:"always"},children:[n!==me&&t.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(0.75px)",WebkitBackdropFilter:"blur(0.75px)",borderRadius:"0.3rem",pointerEvents:"none",transition:"background-color 0.4s cubic-bezier(0.4, 0.0, 0.2, 1), backdrop-filter 0.4s cubic-bezier(0.4, 0.0, 0.2, 1)"}}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"font-semibold truncate text-white",style:{marginBottom:"3px",fontSize:"13px"},children:e.lesson_name||`Lesson ${e.lesson_number}`}),t.jsx("ul",{style:{display:"flex",flexDirection:"column",gap:"0.01rem"},children:(e.bullet_points||[]).slice(0,3).map((l,d)=>t.jsxs("li",{className:"text-xs flex items-start gap-2 text-purple-100",children:[t.jsx("span",{className:"mt-0.5 text-purple-200",children:"‚Ä¢"}),t.jsx("span",{children:l})]},d))})]}),(s||c)&&t.jsx("button",{className:"bg-white text-black font-bold hover:bg-purple-50 transition-colors flex-shrink-0 group",style:{width:"48px",height:"48px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"0.3rem",marginRight:"10px"},onClick:()=>{Z(`/learning?module=${e.module_number}&lesson=${e.lesson_number}`)},children:t.jsx("svg",{className:"group-hover:stroke-pink-500 transition-colors",width:"26",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:t.jsx("path",{d:"M5 12h14M12 5l7 7-7 7"})})})]},`${e.module_number}-${e.lesson_number}`)}):t.jsx("div",{className:"flex-1 bg-gradient-to-br from-purple-600 to-purple-700 rounded-lg flex items-center justify-center",style:{padding:"7.398px"},children:t.jsx("p",{className:"text-purple-200 text-sm",children:"No more upcoming lessons"})})})}),(()=>{const e=G.length===J.length&&J.length>0,n=J.findIndex(c=>!Se(c.module_number,c.lesson_number)),s=me!==n,r=me<n;return s&&!e&&t.jsx("button",{onClick:ns,className:"absolute bg-white text-black hover:bg-purple-50 transition-all",style:{right:"42px",top:"50%",transform:"translateY(-35%)",width:"40px",height:"40px",borderRadius:"0.3rem",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",zIndex:10,opacity:.7},children:r?t.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:t.jsx("path",{d:"M5 12h14M12 5l7 7-7 7"})}):t.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:t.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})})})})()]}),t.jsxs("div",{className:"flex-1 flex flex-col px-8 overflow-hidden",style:{paddingTop:"0px",paddingBottom:fe?"8px":"17.6px"},children:[t.jsx("h3",{className:"flex-shrink-0 font-semibold",style:{fontSize:"19px",marginBottom:"1px"},children:"Chat with Will"}),t.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[t.jsxs("div",{ref:$t,className:"bg-white overflow-y-auto hide-scrollbar flex flex-col justify-end",style:{borderRadius:"0.3rem 0.3rem 0 0",marginBottom:"0px",scrollbarWidth:"none",msOverflowStyle:"none",flex:"0.98",minHeight:"0",padding:"1.5rem 1rem 0.8rem 1rem"},children:[ue.map((e,n)=>t.jsx("div",{className:e.type==="user"?"flex justify-end":"",style:{animation:"slideUp 0.3s ease-out",opacity:1,marginBottom:n<ue.length-1?"0.5rem":"0"},children:e.type==="assistant"?t.jsx("div",{className:"p-3 text-black text-sm leading-snug relative group inline-block max-w-[95%]",style:{position:"relative",borderRadius:"8px",backgroundColor:"#f3f4f6"},children:(ye===n&&!e.isComplete?st:!e.isComplete&&ye===null?"":e.text).split(`
`).map((s,r)=>{const c=s.match(/^[‚Ä¢\-\*]\s+(.+?):\s*(.*)$/),l=s.match(/^[‚Ä¢\-\*]\s+(.+?)\s+-\s+(.*)$/),d=s.match(/^(\d+)\.\s+(.+?):\s*(.*)$/),i=s.match(/^(\d+)\.\s+(.+?)\s+-\s+(.*)$/);if(c){const m=c[1].replace(/\*\*/g,""),u=c[2].replace(/\*\*/g,"");return t.jsxs("p",{className:r>0?"mt-2":"",children:[t.jsxs("span",{children:[c[0].charAt(0)," "]}),t.jsxs("strong",{className:"font-semibold",children:[m,":"]}),t.jsxs("span",{children:[" ",u]})]},r)}else if(l){const m=l[1].replace(/\*\*/g,""),u=l[2].replace(/\*\*/g,"");return t.jsxs("p",{className:r>0?"mt-2":"",children:[t.jsxs("span",{children:[l[0].charAt(0)," "]}),t.jsx("strong",{className:"font-semibold",children:m}),t.jsxs("span",{children:[" - ",u]})]},r)}else if(d){const m=d[2].replace(/\*\*/g,""),u=d[3].replace(/\*\*/g,"");return t.jsxs("p",{className:r>0?"mt-2":"",children:[t.jsxs("span",{children:[d[1],". "]}),t.jsxs("strong",{className:"font-semibold",children:[m,":"]}),t.jsxs("span",{children:[" ",u]})]},r)}else if(i){const m=i[2].replace(/\*\*/g,""),u=i[3].replace(/\*\*/g,"");return t.jsxs("p",{className:r>0?"mt-2":"",children:[t.jsxs("span",{children:[i[1],". "]}),t.jsx("strong",{className:"font-semibold",children:m}),t.jsxs("span",{children:[" - ",u]})]},r)}else{const m=s.split(/(\*\*.*?\*\*|\*.*?\*|DNA|RNA|Proteins)/g);return t.jsx("p",{className:r>0?"mt-2":"",children:m.map((u,g)=>{if(u.startsWith("**")&&u.endsWith("**")&&u.length>4){const W=u.slice(2,-2);return t.jsx("strong",{className:"font-semibold",children:W},g)}else if(u.startsWith("*")&&u.endsWith("*")&&u.length>2&&!u.startsWith("**")){const W=u.slice(1,-1);return t.jsx("em",{className:"italic",children:W},g)}else if(u==="DNA"||u==="RNA"||u==="Proteins")return t.jsx("strong",{className:"font-semibold",children:u},g);return t.jsx("span",{children:u},g)})},r)}})}):t.jsx("div",{className:"p-3 text-white text-sm max-w-[95%] inline-block",style:{position:"relative",borderRadius:"8px",backgroundColor:"#7c3aed"},children:e.text})},n)),dt&&t.jsx("div",{style:{animation:"slideUp 0.3s ease-out",marginTop:"1rem"},children:t.jsx("div",{className:"p-3 text-black text-sm leading-snug inline-block max-w-[95%]",style:{position:"relative",borderRadius:"8px",backgroundColor:"#f3f4f6"},children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),t.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),t.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})})]}),t.jsxs("div",{className:"flex-shrink-0 bg-gray-100 p-3",style:{marginTop:"0px",borderRadius:"0 0 0.3rem 0.3rem"},children:[t.jsx("form",{"data-chat-form":!0,onSubmit:qn,style:{marginBottom:"8px"},children:t.jsx("input",{type:"text",value:Te,onChange:e=>Ie(e.target.value),onFocus:()=>{Ke(!1),rn(!0)},onBlur:()=>{Ke(!0),rn(!1)},placeholder:ct?"type to understand or select below":"",className:"w-full bg-gray-100 px-5 text-sm text-center focus:outline-none placeholder-gray-500 text-black caret-gray-500",style:{borderRadius:"0 0 0.75rem 0.75rem",paddingTop:"0.4rem",paddingBottom:"0.4rem"}})}),rt&&t.jsx("button",{onClick:async()=>{const e=rt,n=[...ue,{type:"user",text:e}];we(n),_e(!0);try{const s=R.length>0?`
Lesson: ${Re}

Content:
${R.map(l=>{var d,i;return l.content_type==="heading"?`## ${((d=l.content)==null?void 0:d.text)||l.title}`:l.content_type==="paragraph"?typeof l.content=="string"?l.content:((i=l.content)==null?void 0:i.text)||l.content_text||"":""}).filter(Boolean).join(`

`)}
`:"",c=await(await fetch("https://ignite-education-api.onrender.com/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:n,lessonContext:s})})).json();if(_e(!1),c.success){const l=n.length;we(d=>[...d,{type:"assistant",text:c.response,isComplete:!1}]),ie(l)}else throw new Error(c.error||"Failed to get response")}catch(s){console.error("Error sending message:",s),_e(!1);const r=n.length;we(c=>[...c,{type:"assistant",text:"Sorry, I encountered an error. Please try again.",isComplete:!1}]),ie(r)}},className:"flex-shrink-0 w-full text-white px-4 py-2 font-medium transition overflow-hidden",style:{borderRadius:"1rem",fontSize:"0.85rem",backgroundColor:"#7714E0",hover:{backgroundColor:"#6610C7"}},onMouseEnter:e=>e.currentTarget.style.backgroundColor="#6610C7",onMouseLeave:e=>e.currentTarget.style.backgroundColor="#7714E0",children:rt.split("").map((e,n)=>t.jsx("span",{style:{display:"inline-block",animation:"letterSlideUp 0.12s ease-out forwards",animationDelay:`${n*.008}s`,opacity:0,transform:"translateY(3px)"},children:e===" "?"¬†":e},n))},rt)]}),t.jsxs("div",{className:`flex-shrink-0 ${fe?"mt-2":"mt-8"} w-full relative`,children:[!fe&&t.jsx("button",{onClick:ss,className:"absolute -top-5 left-0 text-white hover:text-pink-500 transition text-sm cursor-pointer",children:"Go ad-free for 99p"}),t.jsx(zs,{adClient:"ca-pub-8629703639546275",adSlot:"3322377575",adFormat:"auto",style:{minHeight:"60px"},isAdFree:fe})]})]})]})]}),t.jsxs("div",{className:"flex-1 flex flex-col bg-white text-black overflow-hidden relative",style:{minWidth:"600px",flexShrink:0},children:[Ct&&Nt&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-50",style:{backgroundColor:"rgba(255, 255, 255, 0.5)"},children:t.jsx("div",{className:"text-center flex flex-col gap-4 max-w-md px-6",children:Vt==="daily_limit"?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-2xl text-black font-semibold",children:"Daily Course Limit Reached"}),t.jsxs("div",{className:"text-lg text-gray-700",children:["You've completed 2 courses today. Come back on ",t.jsx("span",{className:"font-semibold",children:_n})," to continue learning."]}),t.jsx("button",{onClick:()=>window.location.href="/",className:"px-6 py-2 rounded-lg transition",style:{backgroundColor:"#EF0B72",color:"white"},onMouseEnter:e=>e.target.style.backgroundColor="#D90A65",onMouseLeave:e=>e.target.style.backgroundColor="#EF0B72",children:"Back to Progress Hub"})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-xl text-black font-semibold",children:"Lesson not available yet"}),t.jsx("button",{onClick:()=>window.location.href=`/learning?module=${Nt.module_number}&lesson=${Nt.lesson_number}`,className:"px-6 py-2 rounded-lg transition",style:{backgroundColor:"#EF0B72",color:"white"},onMouseEnter:e=>e.target.style.backgroundColor="#D90A65",onMouseLeave:e=>e.target.style.backgroundColor="#EF0B72",children:"Go to Current Lesson"})]})})}),t.jsx("div",{ref:Qe,className:"flex-1 overflow-y-auto px-16 py-8 pb-20",style:{scrollbarWidth:"none",msOverflowStyle:"none",position:"relative"},children:t.jsxs("div",{className:"max-w-4xl mx-auto space-y-0",style:{position:"relative",zIndex:2},children:[t.jsxs("div",{style:{marginTop:"2rem",marginBottom:"1.5rem"},children:[t.jsxs("p",{className:"text-xl font-medium",style:{color:"#EF0B72",marginBottom:"0.25rem"},children:["Lesson ",(()=>{const n=[...le].sort((s,r)=>s.module_number!==r.module_number?s.module_number-r.module_number:s.lesson_number-r.lesson_number).findIndex(s=>s.module_number===M&&s.lesson_number===B);return n!==-1?n+1:B})()]}),t.jsx("div",{className:"bg-black text-white px-3 flex items-center",style:{borderRadius:"0.2rem",paddingTop:"1rem",paddingBottom:"1rem",maxWidth:"750px",width:"fit-content"},children:t.jsx("h1",{className:"text-3xl font-medium text-left",children:tt(Re,0,"title",!0)})})]}),t.jsxs("div",{style:{filter:Ct?"blur(8px)":"none",pointerEvents:Ct?"none":"auto"},children:[R.map((e,n)=>{const s=()=>{var r,c,l,d;if(e.content_type==="heading"){const i=((r=e.content)==null?void 0:r.level)||2,m=((c=e.content)==null?void 0:c.text)||e.title,u=`h${i}`,g={1:"text-3xl",2:"text-2xl",3:"text-xl"},W=R.slice(0,n).map(f=>et(f)).join(". ").split(/\s+/).filter(f=>f.length>0).length,U=(f,C)=>{const X=f.split(/(__[^_]+__)/g);let K=C;return X.map((P,oe)=>{const z=P.replace(/__/g,"").split(/\s+/).filter(O=>O.length>0).length;let N;if(P.startsWith("__")&&P.endsWith("__")){const O=P.slice(2,-2);N=t.jsx("u",{children:tt(O,K,n,!0)},oe)}else N=t.jsx("span",{children:tt(P,K,n,!0)},oe);return K+=z,N})};return i===2?t.jsx("div",{className:"bg-black text-white flex items-center mb-2",style:{borderRadius:"0.2rem",paddingTop:"0.35rem",paddingBottom:"0.35rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",maxWidth:"750px",width:"fit-content",marginTop:"3rem"},children:Y.createElement(u,{className:"font-medium",style:{fontSize:"1.4rem"}},U(m,W))}):Y.createElement(u,{className:`${g[i]} font-bold mt-8 mb-2`},U(m,W))}if(e.content_type==="paragraph"){const i=typeof e.content=="string"?e.content:((l=e.content)==null?void 0:l.text)||e.content_text,m=R.slice(0,n).map(f=>et(f)).join(". ").split(/\s+/).filter(f=>f.length>0).length,u=(f,C=0)=>{const X=f.split(new RegExp("(\\*\\*[^*]+\\*\\*|__[^_]+__|\\[(?:[^\\]]+)\\]\\((?:[^)]+)\\)|(?<!\\*)\\*(?!\\*)([^*]+)\\*(?!\\*))","g"));let K=C;return X.map((P,oe)=>{if(P===void 0)return null;const I=P.match(/^\[([^\]]+)\]\(([^)]+)\)$/),N=P.replace(/\*\*/g,"").replace(/__/g,"").replace(new RegExp("(?<!\\*)\\*(?!\\*)","g"),"").replace(/\[([^\]]+)\]\([^)]+\)/g,"$1").split(/\s+/).filter(_=>_.length>0).length;let O;if(I){const _=I[1],be=I[2];O=t.jsx("a",{href:be,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline hover:text-blue-800",children:tt(_,K,n)},oe)}else if(P.startsWith("**")&&P.endsWith("**")){const _=P.slice(2,-2);O=t.jsx("strong",{className:"font-semibold",children:tt(_,K,n)},oe)}else if(P.startsWith("__")&&P.endsWith("__")){const _=P.slice(2,-2);O=t.jsx("u",{children:tt(_,K,n)},oe)}else if(P.match(new RegExp("^(?<!\\*)\\*(?!\\*)([^*]+)\\*(?!\\*)$"))){const _=P.slice(1,-1);O=t.jsx("em",{children:tt(_,K,n)},oe)}else O=t.jsx("span",{children:tt(P,K,n)},oe);return K+=N,O})},g=i.split(`
`),W=g.some(f=>/^[‚Ä¢\-]\s/.test(f.trim())),U=g.filter(f=>f.trim()).length>1;if(W||U){let f=m;return t.jsx("div",{className:"mb-6",children:g.map((C,X)=>{const K=C.trim();if(/^[‚Ä¢\-]\s/.test(K)){const P=K.replace(/^[‚Ä¢\-]\s+/,""),I=P.replace(/\*\*/g,"").replace(/__/g,"").replace(new RegExp("(?<!\\*)\\*(?!\\*)","g"),"").replace(/\[([^\]]+)\]\([^)]+\)/g,"$1").split(/\s+/).filter(N=>N.length>0).length,z=t.jsxs("div",{className:"flex items-start gap-2 mb-1",children:[t.jsx("span",{className:"text-black mt-1",children:"‚Ä¢"}),t.jsx("span",{className:"text-base leading-relaxed flex-1",children:u(P,f)})]},X);return f+=I,z}else if(K){const oe=C.replace(/\*\*/g,"").replace(/__/g,"").replace(new RegExp("(?<!\\*)\\*(?!\\*)","g"),"").replace(/\[([^\]]+)\]\([^)]+\)/g,"$1").split(/\s+/).filter(z=>z.length>0).length,I=t.jsx("p",{className:"text-base leading-relaxed mb-2",children:u(C,f)},X);return f+=oe,I}else if(U)return t.jsx("div",{className:"h-2"},X);return null})})}return t.jsx("p",{className:"text-base leading-relaxed mb-6",children:u(i,m)})}if(e.content_type==="image"){const i=e.content||{},m=i.width==="small"?"max-w-sm":i.width==="medium"?"max-w-md":i.width==="large"?"max-w-lg":i.width==="xl"?"max-w-xl":i.width==="2xl"?"max-w-2xl":i.width==="full"?"max-w-full":"max-w-lg";return t.jsxs("div",{className:"my-8 flex flex-col items-center",children:[t.jsx("img",{src:i.url,alt:i.alt||e.title,className:`${m} rounded-lg shadow-lg`}),i.caption&&t.jsx("p",{className:"text-sm text-gray-600 mt-2 italic",children:i.caption})]})}if(e.content_type==="youtube"){const i=e.content||{},m=i.videoId;return t.jsxs("div",{className:"my-8",children:[i.title&&t.jsx("h3",{className:"text-xl font-bold mb-4",children:i.title}),t.jsx("div",{className:"aspect-w-16 aspect-h-9",children:t.jsx("iframe",{src:`https://www.youtube.com/embed/${m}${i.startTime?`?start=${i.startTime}`:""}`,title:i.title||"YouTube video",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,className:"w-full h-96 rounded-lg shadow-lg"})})]})}if(e.content_type==="list"){const i=e.content||{},m=i.type==="ordered"?"ol":"ul",u=i.type==="ordered"?"list-decimal list-inside":"list-disc list-inside";return t.jsx(m,{className:`${u} space-y-3 mb-6`,children:(i.items||[]).map((g,W)=>t.jsx("li",{className:"text-base leading-relaxed",children:g},W))})}if(e.content_type==="bulletlist"){const i=((d=e.content)==null?void 0:d.items)||[];return t.jsx("ul",{className:"list-disc list-inside space-y-2 mb-6",children:i.map((m,u)=>t.jsx("li",{className:"text-base leading-relaxed",children:m},u))})}return e.content&&typeof e.content=="object"?t.jsxs("div",{className:"prose prose-lg max-w-none",children:[e.content.description&&t.jsx("p",{className:"text-lg leading-relaxed mb-6",children:e.content.description}),e.content.points&&Array.isArray(e.content.points)&&t.jsx("ul",{className:"space-y-4 mb-6",children:e.content.points.map((i,m)=>t.jsxs("li",{className:"text-base leading-relaxed",children:[t.jsx("strong",{className:"font-bold",children:i.title})," ",i.description]},m))}),e.content.subsections&&Array.isArray(e.content.subsections)&&t.jsx("div",{className:"space-y-6",children:e.content.subsections.map((i,m)=>t.jsxs("div",{children:[t.jsx("h3",{className:"text-xl font-bold mb-4",children:i.title}),i.description&&t.jsx("p",{className:"text-base leading-relaxed mb-4",children:i.description}),i.list&&t.jsx("ol",{className:"list-decimal list-inside space-y-3",children:i.list.map((u,g)=>t.jsxs("li",{className:"text-base leading-relaxed",children:[u.text&&t.jsxs("span",{children:[u.text," "]}),u.highlight&&t.jsx("strong",{className:"font-bold",children:u.highlight}),u.detail&&t.jsxs("span",{children:[" ",u.detail]})]},g))}),i.image&&t.jsx("div",{className:"my-6 flex justify-center",children:t.jsx("img",{src:i.image,alt:i.title,className:"max-w-md rounded-lg"})})]},m))}),e.content.image&&t.jsx("div",{className:"my-8 flex justify-center",children:t.jsx("img",{src:e.content.image,alt:e.title,className:"max-w-lg rounded-lg shadow-lg"})})]}):t.jsx("p",{className:"text-base leading-relaxed",children:e.content||e.content_text||"No content available for this section."})};return t.jsx("div",{className:"section-content",ref:r=>Pt.current[n]=r,"data-section-index":n,children:s()},e.id||n)}),t.jsx("div",{className:"mt-6 mb-4",children:t.jsxs("div",{className:"flex items-center gap-2 relative",children:[t.jsx("button",{onClick:()=>bn(!0),className:"flex items-center justify-center transition",style:{color:pt===!0?"#EF0B72":"#6B7280",background:"none",border:"none",padding:0,cursor:"pointer"},onMouseEnter:e=>{pt!==!0&&(e.currentTarget.style.color="#EF0B72")},onMouseLeave:e=>{pt!==!0&&(e.currentTarget.style.color="#6B7280")},title:"I liked this lesson",children:t.jsx(Fs,{size:18,fill:"none",strokeWidth:2})}),t.jsx("button",{onClick:()=>bn(!1),className:"flex items-center justify-center transition",style:{color:pt===!1?"#EF0B72":"#6B7280",background:"none",border:"none",padding:0,cursor:"pointer"},onMouseEnter:e=>{pt!==!1&&(e.currentTarget.style.color="#EF0B72")},onMouseLeave:e=>{pt!==!1&&(e.currentTarget.style.color="#6B7280")},title:"I didn't like this lesson",children:t.jsx($s,{size:18,fill:"none",strokeWidth:2})})]})})]})]})}),t.jsxs("div",{className:"absolute bottom-0 left-0 right-0 px-16 py-6 flex items-center justify-center gap-4",style:{zIndex:10},children:[t.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{backdropFilter:"blur(4px)",WebkitBackdropFilter:"blur(4px)",maskImage:"linear-gradient(to bottom, transparent 0%, rgba(0,0,0,0.5) 50%, rgba(0,0,0,1) 100%)",WebkitMaskImage:"linear-gradient(to bottom, transparent 0%, rgba(0,0,0,0.5) 50%, rgba(0,0,0,1) 100%)",zIndex:1}}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent via-white/70 to-white pointer-events-none",style:{zIndex:2}}),t.jsxs("div",{className:"relative z-10 flex items-center justify-center gap-2 w-full",style:{zIndex:20},children:[t.jsx("button",{onClick:ms,className:"rounded-lg flex items-center justify-center transition text-white",style:{backgroundColor:Ve?"#D10A64":"#EF0B72",width:"43px",height:"43px"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="#D10A64",onMouseLeave:e=>e.currentTarget.style.backgroundColor=Ve?"#D10A64":"#EF0B72",children:Ve?t.jsx(Ps,{size:18,className:"text-white",fill:"white"}):t.jsx(Tn,{size:18,className:"text-white"})}),t.jsx("button",{onClick:On,className:"text-white font-semibold rounded-lg transition",style:{backgroundColor:"#EF0B72",paddingLeft:"43px",paddingRight:"43px",paddingTop:"11px",paddingBottom:"11px",fontSize:"15px"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="#D10A64",onMouseLeave:e=>e.currentTarget.style.backgroundColor="#EF0B72",children:"Continue"}),t.jsx("button",{onClick:wn,className:"rounded-lg flex items-center justify-center transition text-white",style:{backgroundColor:"#EF0B72",width:"43px",height:"43px"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="#D10A64",onMouseLeave:e=>e.currentTarget.style.backgroundColor="#EF0B72",children:t.jsx(Bs,{size:18,className:"text-white"})})]})]})]}),E&&t.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 backdrop-blur-sm animate-fadeIn",style:{background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.6))",animation:L?"fadeOut 0.2s ease-out":"fadeIn 0.2s ease-out"},onClick:Jt,children:t.jsx("div",{className:"relative",children:t.jsxs("div",{className:"bg-white relative flex",style:{width:"850px",height:"65vh",minHeight:"100px",padding:"0px",animation:L?"scaleDown 0.2s ease-out":"scaleUp 0.2s ease-out",borderRadius:"0.3rem",overflow:"hidden"},onClick:e=>e.stopPropagation(),children:[t.jsx("button",{onClick:Jt,className:"absolute top-6 right-6 text-gray-600 hover:text-black z-10",children:t.jsx(Tt,{size:24})}),t.jsx("div",{style:{width:"45.6%"},className:"bg-black p-8 flex flex-col justify-center",children:t.jsxs("div",{style:{marginTop:"-10px"},children:[t.jsxs("h3",{className:"text-white text-2xl font-medium",style:{animation:"fadeIn 1.5s ease-out",animationDelay:"0.5s",opacity:0,animationFillMode:"forwards",lineHeight:"1",marginBottom:"1.3rem"},children:[t.jsx("span",{className:"font-light text-lg",children:"For just 99p a week,"}),t.jsx("br",{}),t.jsx("span",{style:{fontSize:"1.4rem",color:"#FFFFFF"},children:"get exclusive access to"})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-3",style:{animation:"fadeInUp 1.5s ease-out",animationDelay:"2s",opacity:0,animationFillMode:"forwards"},children:[t.jsx("div",{className:"bg-white rounded p-1.5 flex-shrink-0",style:{transform:"scale(0.8)"},children:t.jsx("svg",{className:"w-4 h-4 text-black",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:5,d:"M5 13l4 4L19 7"})})}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold text-lg mb-0",style:{color:"#EF0B72"},children:"Office Hours"}),t.jsxs("p",{className:"text-white text-sm opacity-90 m-0",style:{marginTop:"-3px",lineHeight:"1.3"},children:["Get personalised support from",t.jsx("br",{}),"course leaders when you need it."]})]})]}),t.jsxs("div",{className:"flex items-center gap-3",style:{animation:"fadeInUp 1.5s ease-out",animationDelay:"3.0s",opacity:0,animationFillMode:"forwards"},children:[t.jsx("div",{className:"bg-white rounded p-1.5 flex-shrink-0",style:{transform:"scale(0.8)"},children:t.jsx("svg",{className:"w-4 h-4 text-black",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:5,d:"M5 13l4 4L19 7"})})}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold text-lg mb-0",style:{color:"#EF0B72"},children:"Completely Ad-Free"}),t.jsxs("p",{className:"text-white text-sm opacity-90 m-0",style:{marginTop:"-3px",lineHeight:"1.3"},children:["Learn without distractions with",t.jsx("br",{}),"a completely ad-free experience."]})]})]}),t.jsxs("div",{className:"flex items-center gap-3",style:{animation:"fadeInUp 1.5s ease-out",animationDelay:"4s",opacity:0,animationFillMode:"forwards"},children:[t.jsx("div",{className:"bg-white rounded p-1.5 flex-shrink-0",style:{transform:"scale(0.8)"},children:t.jsx("svg",{className:"w-4 h-4 text-black",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:5,d:"M5 13l4 4L19 7"})})}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold text-lg mb-0",style:{color:"#EF0B72"},children:"Weekly Handpicked Roles"}),t.jsxs("p",{className:"text-white text-sm opacity-90 m-0",style:{marginTop:"-3px",lineHeight:"1.3"},children:["We'll send you the top career",t.jsx("br",{}),"opportunities to you every week."]})]})]}),t.jsx("p",{className:"text-white text-sm mt-6",style:{animation:"fadeIn 1.5s ease-out",animationDelay:"6.0s",opacity:0,animationFillMode:"forwards"},children:"Billed weekly. Cancel anytime."})]})]})}),t.jsx("div",{style:{width:"54.4%",scrollbarWidth:"none",msOverflowStyle:"none"},className:"relative overflow-y-auto",children:t.jsx("div",{ref:Gt,style:{minHeight:"350px",paddingTop:"10px",paddingBottom:"10px"}},b)})]})})}),ne&&t.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 backdrop-blur-sm animate-fadeIn",style:{background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.6))",animation:Ee?"fadeOut 0.2s ease-out":"fadeIn 0.2s ease-out"},onClick:Yt,children:t.jsx("div",{className:"relative w-full px-4",style:{maxWidth:"632.5px"},children:t.jsxs("div",{className:"bg-white text-black relative cursor-pointer hover:opacity-95 transition",style:{animation:Ee?"scaleDown 0.2s ease-out":"scaleUp 0.2s ease-out",borderRadius:"0.3rem",padding:"2rem",position:"relative",zIndex:9999},onClick:jn,children:[t.jsx("button",{onClick:e=>{e.stopPropagation(),Yt()},className:"absolute top-4 right-4 text-gray-600 hover:text-black z-10",children:t.jsx(Tt,{size:24})}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-black font-medium text-lg",style:{marginBottom:"0.5rem",paddingTop:"15px"},children:"Congratulations, you've completed your first lesson."}),t.jsxs("p",{className:"text-black mb-6",children:["Add to your LinkedIn to showcase your progress",t.jsx("br",{}),"and we'll send you a free Ignite Tote Bag."]}),t.jsx("div",{className:"mb-6 flex justify-center",children:t.jsx("img",{src:"https://yjvdakdghkfnlhdpbocg.supabase.co/storage/v1/object/public/assets/Screenshot%202025-10-16%20at%2022.16.20.png",alt:"Add to LinkedIn",className:"h-auto rounded-lg",style:{width:"85%"}})}),t.jsxs("button",{onClick:e=>{e.stopPropagation(),jn()},className:"w-full text-white font-semibold py-3 px-6 rounded-lg transition flex items-center justify-center gap-2",style:{backgroundColor:"#EF0B72"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="#D90A65",onMouseLeave:e=>e.currentTarget.style.backgroundColor="#EF0B72",children:["Add to",t.jsx("img",{src:"https://auth.ignite.education/storage/v1/object/public/assets/Linkedin-logo-white-png-wordmark-icon-horizontal-900x233.png",alt:"LinkedIn",style:{height:"18px",marginLeft:"-2px"}})]})]})]})})}),t.jsx(KnowledgeCheck,{isOpen:j,onClose:Dn,onPass:zn,lessonContext:R.length>0?`
Lesson: ${Re}
Module: ${M}

Sections:
${R.map(e=>`
Title: ${e.title}
Content: ${typeof e.content=="string"?e.content:JSON.stringify(e.content)}
`).join(`
---
`)}
        `.trim():"",priorLessonsContext:(()=>{const e=Pn();return e.length===0?"":e.map(n=>`
Lesson: ${n.lessonName}
Module: ${n.module}, Lesson: ${n.lesson}

Sections:
${n.sections.map(s=>`
Title: ${s.title}
Content: ${typeof s.content=="string"?s.content:JSON.stringify(s.content)}
`).join(`
---
`)}
          `).join(`

========

`).trim()})(),lessonName:Re,moduleNum:M,lessonNum:B,userId:A==null?void 0:A.id,firstName:ge,userRole:Ce,courseName:H,isFirstLesson:M===1&&B===1,nextLessonName:(()=>{const e=[...le].sort((s,r)=>s.module_number!==r.module_number?s.module_number-r.module_number:s.lesson_number-r.lesson_number),n=e.findIndex(s=>s.module_number===M&&s.lesson_number===B);return n>=0&&n<e.length-1?e[n+1].lesson_name:null})()}),xt&&t.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 backdrop-blur-sm",style:{background:"linear-gradient(to bottom, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.6))",animation:tn?"fadeOut 0.2s ease-out":"fadeIn 0.2s ease-out"},onClick:vn,children:t.jsxs("div",{className:"relative",children:[t.jsx("h2",{className:"text-xl font-semibold text-white pl-1",style:{marginBottom:"0.15rem"},children:"Flashcards"}),t.jsxs("div",{className:"bg-white relative flex flex-col",style:{width:"600px",height:"450px",animation:tn?"scaleDown 0.2s ease-out":"scaleUp 0.2s ease-out",borderRadius:"0.3rem"},onClick:e=>e.stopPropagation(),children:[t.jsx("button",{onClick:vn,className:"absolute top-6 right-6 text-gray-600 hover:text-black z-10",children:t.jsx(Tt,{size:24})}),Ln?t.jsx("div",{className:"flex-1 flex items-center justify-center px-8 py-8",children:q?t.jsx(vs,{animationData:q,loop:!0,autoplay:!0,style:{width:150,height:150}}):t.jsx("p",{className:"text-gray-500",children:"Loading flashcards..."})}):sn?t.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center px-8 py-8",children:[t.jsx("p",{className:"text-red-500 text-center mb-4",children:sn}),t.jsx("button",{onClick:wn,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:"Retry"})]}):Ue.length===0?t.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center px-8 py-8",children:[t.jsx("p",{className:"text-gray-500 text-center mb-2",children:"No flashcards available for this lesson yet."}),t.jsx("p",{className:"text-gray-400 text-sm text-center",children:"Check back later or contact your instructor."})]}):t.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center px-8 pb-4",style:{paddingTop:"1px"},children:[t.jsxs("div",{className:"flex items-center gap-3 w-full mb-4",children:[t.jsxs("button",{onClick:Hn,disabled:Ae===0,className:"px-3 py-1.5 text-sm bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1.5",children:[t.jsx(Os,{size:16}),"Previous"]}),t.jsxs("button",{onClick:Un,disabled:Ae===Ue.length-1,className:"px-3 py-1.5 text-sm text-white rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1.5",style:{backgroundColor:"#EF0B72"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="#D10A64",onMouseLeave:e=>e.currentTarget.style.backgroundColor="#EF0B72",children:["Next",t.jsx(Ds,{size:16})]}),t.jsxs("div",{className:"text-sm text-gray-500",children:[Ae+1," / ",Ue.length]})]}),t.jsx("div",{onClick:Wn,className:"w-full cursor-pointer select-none",style:{userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",height:"306px"},children:t.jsxs("div",{className:"relative w-full h-full",children:[!Lt&&t.jsx("div",{className:"w-full h-full rounded-lg px-12 py-6",style:{backgroundColor:"#7c3aed"},children:t.jsxs("div",{className:"flex flex-col h-full justify-center",children:[t.jsx("p",{className:"text-base font-medium text-white mb-1.5 text-left",children:"Question"}),t.jsx("p",{className:"text-2xl font-medium text-white text-left",style:{maxWidth:"400px"},children:Ue[Ae].question})]})}),Lt&&t.jsx("div",{className:"w-full h-full bg-black rounded-lg px-4 py-6",children:t.jsx("div",{className:"flex flex-col h-full justify-center",children:t.jsx("div",{className:"overflow-y-auto px-2",children:t.jsx("div",{className:"text-base text-white space-y-2 w-full",children:Ue[Ae].answer.split(`
`).map((e,n)=>{if(e.trim().startsWith("‚Ä¢")){const r=e.trim().substring(1).trim().split(/(\*\*[^*]+\*\*)/g);return t.jsxs("div",{className:"flex gap-2",children:[t.jsx("span",{className:"flex-shrink-0 text-white",children:"‚Ä¢"}),t.jsx("span",{className:"text-left flex-1",children:r.map((c,l)=>c.startsWith("**")&&c.endsWith("**")?t.jsx("span",{style:{color:"#EF0B72",fontWeight:500},children:c.slice(2,-2)},l):c)})]},n)}else if(e.trim())return t.jsx("p",{className:"mt-3 text-center",children:e},n);return null})})})})})]})}),t.jsx("p",{className:"text-xs text-gray-500 mt-2 text-left w-full",children:Lt?"Click to hide":"Click to reveal"})]})]})]})}),He&&(()=>{var c;const e=(c=an.find(l=>l.id===He))==null?void 0:c.explanation,n=400;let s=vt.x;const r=n/2;return s-r<10?s=r+10:s+r>window.innerWidth-10&&(s=window.innerWidth-r-10),t.jsxs("div",{"data-popup-notes":!0,className:"fixed rounded shadow-xl p-4 z-50",style:{left:`${s}px`,top:vt.preferAbove?"auto":`${vt.y+10}px`,bottom:vt.preferAbove?`${window.innerHeight-vt.y+10}px`:"auto",transform:"translateX(-50%)",maxHeight:"500px",width:"400px",overflowY:"auto",backgroundColor:"#fce7f3",color:"#000",pointerEvents:"auto"},onMouseEnter:()=>{he.current&&(clearTimeout(he.current),he.current=null),At(!0)},onMouseLeave:()=>{mt||(At(!1),he.current=setTimeout(()=>{ze(null)},300))},children:[t.jsxs("div",{className:"flex items-start justify-between",style:{marginBottom:"0.3rem"},children:[t.jsx("h4",{className:"font-semibold text-base text-gray-800",children:"Additional Notes"}),t.jsx("div",{className:"flex gap-1",children:mt?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:l=>{l.stopPropagation(),Yn(He)},className:"p-1 hover:bg-pink-200 rounded transition-colors text-gray-700",title:"Save changes",children:t.jsx(Hs,{size:16})}),t.jsx("button",{onClick:l=>{l.stopPropagation(),Jn()},className:"p-1 hover:bg-pink-200 rounded transition-colors text-gray-700",title:"Cancel",children:t.jsx(Tt,{size:16})})]}):t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:l=>{l.stopPropagation(),Qn(e)},className:`p-1 hover:bg-pink-200 rounded transition-colors ${qt?"text-pink-600":"text-gray-700"}`,title:qt?"Stop reading":"Read aloud",children:t.jsx(Tn,{size:16})}),t.jsx("button",{onClick:l=>{l.stopPropagation(),Kn(e)},className:"p-1 hover:bg-pink-200 rounded transition-colors text-gray-700",title:"Edit explanation",children:t.jsx(Ws,{size:16})}),t.jsx("button",{onClick:l=>{l.stopPropagation(),Gn(He)},className:"p-1 hover:bg-pink-200 rounded transition-colors text-gray-700",title:"Delete explanation",children:t.jsx(Us,{size:16})})]})})]}),t.jsx("div",{ref:Ft,contentEditable:mt,suppressContentEditableWarning:!0,onInput:l=>{mt&&It(l.currentTarget.textContent)},onClick:l=>l.stopPropagation(),className:`text-sm leading-snug text-gray-800 focus:outline-none min-h-[100px] ${mt?"cursor-text":""}`,style:{whiteSpace:"pre-wrap",wordWrap:"break-word"},children:mt?zt:is(e)})]})})()]})]})};export{so as default};
